
http://dreamproject.fr/koinkoin_20170315/public/index.php/scrap/maquette1


![](http://dreamproject.fr/koinkoin/archives/screenshot_maquette_20170318.png)

![Koinkoin Screenshot](archives/screenshot_maquette_20170318.png)

![Koinkoin Screenshot](http://dreamproject.fr/koinkoin/archives/screenshot_maquette_20170318.png)

<img src="http://dreamproject.fr/koinkoin/archives/screenshot_maquette_20170318.png" alt="Smiley face" height="42" width="42">
Try it Yourself Â»




http://dreamproject.fr/koinkoin/archives/screenshot_maquette_20170318.png



		if ($header == "password")
		{
			$header = "[PRIVE...]";
		}


# Dump

Debugging tool which displays information about any PHP variable, class or exception.

Inspired in the tool [Krumo developed by mrasnika](http://krumo.sourceforge.net/).

### Usage

For using `Dump`, you only need to include the script, and configure it with the URL of the static resources, and, optionally, with the special paths that your application use:

	include 'Dump.php';
	Dump::config('/url/to/dump-static', array(
	    'APP_PATH' => '/home/app/www',
	    'SYSTEM_PATH' => '/home/app/src'
	  )
	);

And then, for dump information about any variable, resource or exception you only need to do:
	
	dump($var)

### Features

- Interactive dump of almost types of variables.
- Source code viewer with syntax highlighting.
- Object reflection.
- String viewer with plain and html mode.
- Comprehensive analysis of exceptions.
- Dynamic overlay that floats over top of web page. 

### Screenshots

![](https://github.com/javiermarinros/dump/raw/master/screenshot.png)







a:35:{i:0;a:5:{s:2:"id";s:9:"421547691";s:5:"title";s:48:"F1 bis axe jean jaures / tramway/ cour privative";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421547691.htm?ca=15_s";s:9:"timestamp";i:1358519160;s:5:"price";s:15:"400&nbsp;&euro;";}i:1;a:5:{s:2:"id";s:9:"417421386";s:5:"title";s:37:"F3 nancy rue gabriel mouilleron nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417421386.htm?ca=15_s";s:9:"timestamp";i:1358517900;s:5:"price";s:15:"490&nbsp;&euro;";}i:2;a:5:{s:2:"id";s:9:"417428243";s:5:"title";s:47:"F2 nancy rue de la salle proche hopital central";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417428243.htm?ca=15_s";s:9:"timestamp";i:1358517120;s:5:"price";s:15:"450&nbsp;&euro;";}i:3;a:5:{s:2:"id";s:9:"418665861";s:5:"title";s:25:"Appartement F2 NANCY 41m2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/418665861.htm?ca=15_s";s:9:"timestamp";i:1358516340;s:5:"price";s:15:"500&nbsp;&euro;";}i:4;a:5:{s:2:"id";s:9:"414934361";s:5:"title";s:15:"Location studio";s:3:"url";s:55:"http://www.leboncoin.fr/locations/414934361.htm?ca=15_s";s:9:"timestamp";i:1358512320;s:5:"price";s:15:"350&nbsp;&euro;";}i:5;a:5:{s:2:"id";s:9:"421486388";s:5:"title";s:13:"Maginfique F3";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421486388.htm?ca=15_s";s:9:"timestamp";i:1358511840;s:5:"price";s:15:"550&nbsp;&euro;";}i:6;a:5:{s:2:"id";s:9:"421479122";s:5:"title";s:44:"F2 40 m2 NANCY CENTRE + Parking priv&eacute;";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421479122.htm?ca=15_s";s:9:"timestamp";i:1358510700;s:5:"price";s:15:"500&nbsp;&euro;";}i:7;a:5:{s:2:"id";s:9:"417743640";s:5:"title";s:12:"F2&#45;Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417743640.htm?ca=15_s";s:9:"timestamp";i:1358507940;s:5:"price";s:15:"470&nbsp;&euro;";}i:8;a:5:{s:2:"id";s:9:"412251803";s:5:"title";s:33:"F1 NANCY Quartier IUT Charlemagne";s:3:"url";s:55:"http://www.leboncoin.fr/locations/412251803.htm?ca=15_s";s:9:"timestamp";i:1358506320;s:5:"price";s:15:"400&nbsp;&euro;";}i:9;a:5:{s:2:"id";s:9:"418148476";s:5:"title";s:53:"Beau T2 meubl&eacute; secteur Nancy Cath&eacute;drale";s:3:"url";s:55:"http://www.leboncoin.fr/locations/418148476.htm?ca=15_s";s:9:"timestamp";i:1358505840;s:5:"price";s:15:"550&nbsp;&euro;";}i:10;a:5:{s:2:"id";s:9:"407640096";s:5:"title";s:52:"Nancy appart recent de qualit&eacute; garage terasse";s:3:"url";s:55:"http://www.leboncoin.fr/locations/407640096.htm?ca=15_s";s:9:"timestamp";i:1358503920;s:5:"price";s:15:"495&nbsp;&euro;";}i:11;a:5:{s:2:"id";s:9:"412227706";s:5:"title";s:39:"Grand F3 calme en plein cenre&#45;ville";s:3:"url";s:55:"http://www.leboncoin.fr/locations/412227706.htm?ca=15_s";s:9:"timestamp";i:1358503380;s:5:"price";s:15:"530&nbsp;&euro;";}i:12;a:5:{s:2:"id";s:9:"403769406";s:5:"title";s:21:"Studio &agrave; NANCY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/403769406.htm?ca=15_s";s:9:"timestamp";i:1358502660;s:5:"price";s:15:"400&nbsp;&euro;";}i:13;a:5:{s:2:"id";s:9:"421406560";s:5:"title";s:21:"F2 Hyper centre Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421406560.htm?ca=15_s";s:9:"timestamp";i:1358500080;s:5:"price";s:15:"550&nbsp;&euro;";}i:14;a:5:{s:2:"id";s:9:"419034830";s:5:"title";s:36:"F1 au centre de Nancy &agrave; louer";s:3:"url";s:55:"http://www.leboncoin.fr/locations/419034830.htm?ca=15_s";s:9:"timestamp";i:1358499600;s:5:"price";s:15:"395&nbsp;&euro;";}i:15;a:5:{s:2:"id";s:9:"421393785";s:5:"title";s:57:"F2 &agrave; Nancy rue de la Colline proche fac de lettres";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421393785.htm?ca=15_s";s:9:"timestamp";i:1358498280;s:5:"price";s:15:"435&nbsp;&euro;";}i:16;a:5:{s:2:"id";s:9:"421365412";s:5:"title";s:13:"F2 clemenceau";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421365412.htm?ca=15_s";s:9:"timestamp";i:1358493420;s:5:"price";s:15:"480&nbsp;&euro;";}i:17;a:5:{s:2:"id";s:9:"388249719";s:5:"title";s:15:"F2 f1 bis nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/388249719.htm?ca=15_s";s:9:"timestamp";i:1358492580;s:5:"price";s:15:"430&nbsp;&euro;";}i:18;a:5:{s:2:"id";s:9:"420922055";s:5:"title";s:48:"Location F3 rue R Poincar&eacute; &agrave; Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/420922055.htm?ca=15_s";s:9:"timestamp";i:1358492100;s:5:"price";s:15:"475&nbsp;&euro;";}i:19;a:5:{s:2:"id";s:9:"421329869";s:5:"title";s:46:"APPARTEMENT F2 BIS NANCY GARE , secteur ISABEY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421329869.htm?ca=15_s";s:9:"timestamp";i:1358474100;s:5:"price";s:15:"485&nbsp;&euro;";}i:20;a:5:{s:2:"id";s:9:"316405516";s:5:"title";s:24:"F1 F1 T1 bis f2 F2 nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/316405516.htm?ca=15_s";s:9:"timestamp";i:1358467500;s:5:"price";s:15:"430&nbsp;&euro;";}i:21;a:5:{s:2:"id";s:9:"410723600";s:5:"title";s:42:"Nancy ville vieille rue du ht bourgeois f2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/410723600.htm?ca=15_s";s:9:"timestamp";i:1358466900;s:5:"price";s:15:"425&nbsp;&euro;";}i:22;a:5:{s:2:"id";s:9:"413306095";s:5:"title";s:23:"Studio quartier Blandan";s:3:"url";s:55:"http://www.leboncoin.fr/locations/413306095.htm?ca=15_s";s:9:"timestamp";i:1358464800;s:5:"price";s:15:"320&nbsp;&euro;";}i:23;a:5:{s:2:"id";s:9:"421310656";s:5:"title";s:12:"F1 bis NANCY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421310656.htm?ca=15_s";s:9:"timestamp";i:1358464740;s:5:"price";s:15:"385&nbsp;&euro;";}i:24;a:5:{s:2:"id";s:9:"415237939";s:5:"title";s:28:"Nancy quartier cathedrale f1";s:3:"url";s:55:"http://www.leboncoin.fr/locations/415237939.htm?ca=15_s";s:9:"timestamp";i:1358462940;s:5:"price";s:15:"365&nbsp;&euro;";}i:25;a:5:{s:2:"id";s:9:"421294125";s:5:"title";s:22:"F1 Duplex Nancy Centre";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421294125.htm?ca=15_s";s:9:"timestamp";i:1358458800;s:5:"price";s:15:"400&nbsp;&euro;";}i:26;a:5:{s:2:"id";s:9:"417992115";s:5:"title";s:2:"F2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417992115.htm?ca=15_s";s:9:"timestamp";i:1358458620;s:5:"price";s:15:"459&nbsp;&euro;";}i:27;a:5:{s:2:"id";s:9:"421258405";s:5:"title";s:25:"F1 bis rue Kleber (nancy)";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421258405.htm?ca=15_s";s:9:"timestamp";i:1358453760;s:5:"price";s:15:"395&nbsp;&euro;";}i:28;a:5:{s:2:"id";s:9:"421247962";s:5:"title";s:35:"Nancy location studio meubl&eacute;";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421247962.htm?ca=15_s";s:9:"timestamp";i:1358451960;s:5:"price";s:15:"300&nbsp;&euro;";}i:29;a:5:{s:2:"id";s:9:"390276837";s:5:"title";s:75:"F1 Nancy &#45; 24 m2 &#45; proche &eacute;coles et fac &#45; Nab&eacute;cor";s:3:"url";s:55:"http://www.leboncoin.fr/locations/390276837.htm?ca=15_s";s:9:"timestamp";i:1358451300;s:5:"price";s:15:"330&nbsp;&euro;";}i:30;a:5:{s:2:"id";s:9:"414663874";s:5:"title";s:6:"Studio";s:3:"url";s:55:"http://www.leboncoin.fr/locations/414663874.htm?ca=15_s";s:9:"timestamp";i:1358449380;s:5:"price";s:15:"350&nbsp;&euro;";}i:31;a:5:{s:2:"id";s:9:"421191157";s:5:"title";s:51:"STUDIO tout&#45;&eacute;quip&eacute; &agrave; louer";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421191157.htm?ca=15_s";s:9:"timestamp";i:1358444340;s:5:"price";s:15:"380&nbsp;&euro;";}i:32;a:5:{s:2:"id";s:9:"421185728";s:5:"title";s:19:"F2+terrasse 500euro";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421185728.htm?ca=15_s";s:9:"timestamp";i:1358443980;s:5:"price";s:15:"500&nbsp;&euro;";}i:33;a:5:{s:2:"id";s:9:"421170481";s:5:"title";s:6:"F2 bis";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421170481.htm?ca=15_s";s:9:"timestamp";i:1358442660;s:5:"price";s:15:"520&nbsp;&euro;";}i:34;a:5:{s:2:"id";s:9:"421143578";s:5:"title";s:49:"T2 meubl&eacute; Rue D&eacute;silles (Nancy) 48m2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421143578.htm?ca=15_s";s:9:"timestamp";i:1358438880;s:5:"price";s:15:"550&nbsp;&euro;";}}

<?php

$koinkoin314 = new Koinkoin();

$options = array(
	"recherche_titres_seulement" => 1,
	"codes_postaux" => array("34500","34000","91000"),
	"rayon" => $koinkoin314->searchCategorie("informatique")->code,
	"prix_minimum" => 20,
	"prix_maximum" => 150,
	"annonces_particulier" => true,
	"annonces_pro" => false,
	"annonces_urgentes_seulement" => false
);

$annonces = $koinkoin314->getAnnonces("raspberry", 1, $options);
echo '<pre>'.print_r($annonces, true).'</pre>';
?>



 

    /**
     * Get the list of all available ads
     *
     * Returns an array of ads where one ad has the following format:
     *
     * array(7) {
     *     ["url"]=>
     *     string(52) "https://www.leboncoin.fr/velos/934826585.htm?ca=12_s"
     *     ["image"]=>
     *     string(81) "https://img1.leboncoin.fr/thumbs/010/010a091e6f370cf14f1bf446be768a92e6342d7f.jpg"
     *     ["title"]=>
     *     string(50) "Collier BBB 31.8mm ALU dÃ©railleur avant Ã  BRASER"
     *     ["category"]=>
     *     string(6) "VÃ©los"
     *     ["location"]=>
     *     string(33) "CarriÃ¨res-sous-Poissy / Yvelines"
     *     ["price"]=>
     *     string(7) "10 â¬"
     *     ["date"]=>
     *     string(18) "Aujourd'hui, 14:12"
     * }













	public function getAnnonce($id){

		$result = $this->curl($this->_base . "templates/api/view.json?ad_id={$id}", "ad_id={$id}&{$this->_access}");
		return json_decode($result);

	}

	/*	
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

							OPTIONS

		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~		
		
			{
				search_title_only 	= it,
				categorie 			= c,
				filter (prix|date)	= sp,
				particulier 		= f = p
				pro 				= f = c
				localisation(array) = zipcode
				urgent_only			= ur
				prix_min 			= ps
				prix_max			= pe
			}

		it	 	= Titre uniquement (boolean)
		c 		= catÃ©gorie	(int)
		q 		= Mot clÃ© (string)
		o 		= Page (int)
		sp 		= Filtrer (int) [0 = par date | 1 = par prix]
		f 		= Type de personne (string) [p = particuliers | c = pro | a = tous]
		zipcode = Code postal (string) {dÃ©limiteur: ,}
		ur		= Urgent uniquement (boolean)
		ps		= Prix min (int) {voir plus bas}
		pe		= Prix max (int) {voir plus bas}

		  Url   Prix      Url   Prix      Url   Prix      Url   Prix   
		 ----- ------ 	 ----- ------ 	 ----- ------ 	 ----- ------- 
		    0      0        4     40        8    200       12   1000   
		    1     10        5     50        9    300       13   >1000  
		    2     20        6     75       10    400                   
		    3     30        7    100       11    500                   

		*/










	private function curl($url, $post = false, $cookie = false, $cache = false){
		$ch = curl_init(); 
	    curl_setopt($ch, CURLOPT_URL, $url);
	    if($post != false){
			curl_setopt($ch, CURLOPT_POST, 1);
			curl_setopt($ch, CURLOPT_POSTFIELDS, $post);
			}
	    if($cookie != false){

	    	curl_setopt($ch, CURLOPT_COOKIE, $cookie);
	    }
	    if(!$cache){
	    	$headers = array( 
	        	"Cache-Control: no-cache", 
	        ); 
			curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
	    }
	    $ip = (isset($_SERVER["HTTP_CF_CONNECTING_IP"]))?$_SERVER["HTTP_CF_CONNECTING_IP"]:$_SERVER['REMOTE_ADDR'];
	    curl_setopt($ch, CURLOPT_HTTPHEADER, array("REMOTE_ADDR: ".$ip, "HTTP_X_FORWARDED_FOR: ".$ip));
	    curl_setopt($ch, CURLOPT_USERAGENT,'Leboncoin/3.16.1 (iPhone; iOS 10.0; Scale/2.00)');
		curl_setopt($ch, CURLOPT_REFERER, $url);
	    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); // 1
		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
		curl_setopt($ch, CURLOPT_CONNECTTIMEOUT ,0); 
		curl_setopt($ch, CURLOPT_TIMEOUT, 10);
	    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); 
	    $output = curl_exec($ch); 
	    curl_close($ch); 
	    return $output;
	}













		public function get_xpath_1_filtre_sur_1_page_ssl($url_ssl, $filtre_xpath, $item) {
		// $html = $curl_mes_fonctions_obj->get_curl_1_url_ssl ( $url_ssl );
		// $dom = $dom_mes_fonctions_obj->get_dom_avec_html ( $html );
		// $xpath_dom = $xpath_mes_fonctions_obj->get_xpath_dom ( $dom );
		// $xpath_nodes = $xpath_mes_fonctions_obj->get_xpath_query ( $filtre_xpath );
		// return $this->_get_xpath_1_filtre_sur_1_page_ssl ( $xpath_nodes, $item );
	}
	public function get_xpath_1_filtre_sur_x_page_ssl($url, $html) {
	}
	public function get_xpath_x_filtre_sur_1_page_ssl($url, $html) {
	}
	public function get_xpath_x_filtre_sur_x_page_ssl($url, $html) {
	}
	private function xpath_x_filtre_sur_x_page_ssl($url, $html) {
	}
	
	
			href="<?php APPLICATION_PATH ?>http://127.0.0.1/PROJETS/KOINKOIN/VERSION_LOCALHOST/2_0/public/index.php">KOINKOIN</a>





		$_SESSION ['koinkoin'] ['my_fonctions'] ['dump']->dump_die ( $_SESSION );



		// Post filtre (aprÃ¨s filtre)
// 		$temp = trim ( strip_tags ( $_SESSION ['koinkoin'] ['resultat_scrap'] ) );
// 		$_SESSION ['koinkoin'] ['resultat_scrap'] = $temp;
// 		$_SESSION ['koinkoin'] ['my_fonctions']['dump']->dump_die ( $_SESSION );




			ini_set ( 'display_errors', 'Off' );
		ini_set ( 'display_startup_errors', 'Off' );
		error_reporting ( 0 );
	
	
	
	
	
			foreach ( $resultat_xpath as $node ) {
			// echo "{$node->nodeName} - {$node->nodeValue}";
			// or you can just print out the the XML:
			// $dom->saveXML($node);
		}
	
	
	
	
	
	
				$_SESSION ['koinkoin'] ['my_fonctions_dump']->dump ($resultat );
		
		
		
		phpinfo();
		$_SESSION ['koinkoin'] ['my_fonctions_dump']->dump ( $txt_source_html->value );

		// $_SESSION ['koinkoin'] ['url'] = "https://www.leboncoin.fr/telephonie/offres/ile_de_france/?th=1&q=ip&parrot=0";
		$_SESSION ['koinkoin'] ['url'] = "http://www.metronews.fr/high-tech/comment-eteindre-automatiquement-votre-ecran-lors-du-verrouillage-de-l-ordinateur/mpcy!v82QpIutJlDRU/";


// ancien filtre qui fonctionne encore ?
		$_SESSION ['koinkoin'] ['filtre_xpath_a_utiliser'] = ".//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2";




	public function get_xpath_1_filtre_sur_1_html($txt_source_html, $filtre) {
		// Initialisation de DOM
		$dom = new DOMDocument ();
		$_SESSION ['koinkoin'] ['my_fonctions_dump']->dump_die ($txt_source_html );
	
		$dom->loadHTML ( $txt_source_html );
		$dom_xpath = new DOMXPath ( $dom );
		// Execution de la requete XPATH
		$resultat_xpath = $dom_xpath->query ( $filtre );
		// Recuperation du resultat de la requete XPATH
		foreach ( $resultat_xpath as $result_object ) {
			$resultat = $result_object->childNodes->item ( 0 )->nodeValue;
		}
		// $_SESSION['temp'] = $resultat;
		// echo $_SESSION['temp'];
		// echo $resultat;
		// var_dump($resultat);
		return $resultat;
	}






		// throw new Exception("COQUILLE VIDE !");


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>KOINKOIN  ->  Filtre</title>
	</head>
	<body>
		<h1>- FILTRES -</h1>
		<h2>- RECUPERER 1 VALEUR D'UN FILTRE XPATH D'1 SEULE PAGE WEB -</h2>		
		<?php
			echo "<p>"."Url : ".$_GET['url']."</p>";
			echo "<p>"."Filtre xpath utilise : ".$_GET['filtre']."/p>";
			echo "<p>"."Resultat : ".$_SESSION['resultat']."</p>";
			
		?>

	</body>
</html>






		if (is_string($_SESSION ['koinkoin'] ['resultat_scrap'])) {
			echo "ouiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii";
		}










		function filtre_xpath_url ($url,$filtre)
		{
			ini_set('display_errors','off');
			error_reporting(E_ALL);
			$html = getSslPage($url);
			// Initialisation de DOM
			$dom = new DOMDocument();
			$dom->loadHTML($html);
			$dom_xpath = new DOMXPath($dom);
			// Execution de la requete XPATH
			$resultat_xpath = $dom_xpath->query($filtre);
			// Recuperation du resultat de la requete XPATH
			foreach ($resultat_xpath as $result_object)
			{
				$resultat = $result_object->childNodes->item(0)->nodeValue;
			}
			// 	$_SESSION['temp'] = $resultat;
			// 	echo $_SESSION['temp'];
			//  	echo $resultat;
			// 	var_dump($resultat);
			return $resultat;
		}











		<a
			href="http://127.0.0.1/PROJETS/KOINKOIN/VERSION_LOCALHOST/2_0/public/index.php/scrap/maquette1?page=home">SCRAP
			IT</a>


http://127.0.0.1/PROJETS/KOINKOIN/VERSION_LOCALHOST/2_0/public/index.php/scrap/maquette1?page=home

http://www.metronews.fr/high-tech/comment-eteindre-automatiquement-votre-ecran-lors-du-verrouillage-de-l-ordinateur/mpcy!v82QpIutJlDRU/


<?php
	echo '<!doctype html>'."\n";
	echo '<html>'."\n";
	echo '	<head>'."\n";
	echo '		<title>'.$_SESSION['projet']['nom'].' - '.$_SESSION['projet']['version'].'</title>'."\n";
	echo '	</head>'."\n";
	echo '	<body>'."\n";
	echo '		<div id="zone_haut">'."\n";
	echo '			<h1>KOINKOIN V001</h1>'."\n";
	echo '			<h2>MAQUETTE</h2>'."\n";
	echo '		</div><!-- fin zone_haut -->'."\n";
	echo '		<div id=zone_milieu>'."\n";
	echo '			<h3>FILTRES</h3>'."\n";
	echo '			<h4>Passage des parametres via l\'url</h4>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> trop long</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=page&filtre=id%28%27listingAds%27%29/x:section/x:section/x:ul/x:li[2]&url=https://www.leboncoin.fr/offres_d_emploi/offres/">methode -> methode invoquï¿½ee invalide</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array attendu, seulement 1 url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '			<h3>IHMS</h3>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires formoid/v001/users___creer_un_utilisateur.html">user -> creer un utilisateur</a></li>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires%20formoid/v001/outils___importer_une_page_internet.html">outils -> importer une page web</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '		</div><!-- fin zone_milieu -->'."\n";
	echo '	</body>'."\n";
	echo '</html>'."\n";
?>







<?php
	echo '<!doctype html>'."\n";
	echo '<html>'."\n";
	echo '	<head>'."\n";
	echo '		<title>'.$_SESSION['projet']['nom'].' - '.$_SESSION['projet']['version'].'</title>'."\n";
	echo '	</head>'."\n";
	echo '	<body>'."\n";
	echo '		<div id="zone_haut">'."\n";
	echo '			<h1>KOINKOIN V001</h1>'."\n";
	echo '			<h2>MAQUETTE</h2>'."\n";
	echo '		</div><!-- fin zone_haut -->'."\n";
	echo '		<div id=zone_milieu>'."\n";
	echo '			<h3>FILTRES</h3>'."\n";
	echo '			<h4>Passage des parametres via l\'url</h4>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> trop long</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=page&filtre=id%28%27listingAds%27%29/x:section/x:section/x:ul/x:li[2]&url=https://www.leboncoin.fr/offres_d_emploi/offres/">methode -> methode invoquï¿½ee invalide</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array attendu, seulement 1 url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '			<h3>IHMS</h3>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires formoid/v001/users___creer_un_utilisateur.html">user -> creer un utilisateur</a></li>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires%20formoid/v001/outils___importer_une_page_internet.html">outils -> importer une page web</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '		</div><!-- fin zone_milieu -->'."\n";
	echo '	</body>'."\n";
	echo '</html>'."\n";

	



//  		throw new Exception("<h1>COQUILLE VIDE</h1>");


http://127.0.0.1/PROJETS/KOINKOIN/VERSION_LOCALHOST/2_0/public/index.php/maquette
http://127.0.0.1/PROJETS/KOINKOIN/VERSION_LOCALHOST/2_0/public/index.php/filtre




			<li><span
				style="font-size: 12pt; font-family: 'Times New Roman'; text-transform: none; color: #000000"><a
					href="<?php $this->action('module/controller/action');?>">Telecharge
						1 url pour en extraire 1 contenu par xpath</a></span></li>







		ini_set ( 'display_errors', 'on' );
		error_reporting ( E_ALL );




redacteur
parametres_entree_fonction_origine
				'fonction_en_cours' => 'fonction_en_cours',


				$this->render ( 'releases' );
		
		
		// $_SESSION ['my_fonctions'] ['log'] = new my_fonctions_log ( func_get_args () );
		// $_SESSION ['my_fonctions'] ['log']->logg ( 1, 0, "EMERG", "ALERT", "CRIT", "ERR", "WARN", "NOTICE", "INFO", "DEBUG-index", basename ( __DIR__ ), basename ( __FILE__ ), basename ( __FUNCTION__ ), basename ( __LINE__ ), log_recupere_parametres_fonction ( func_get_args () ), log_recupere_php_backtrace (), 'SESSION_dump_dd_impossible_avant_initialisation_log' );
		
		private function construct_my_fonctions_dump() {
		require_once APPLICATION_PATH . '/../library/my_fonctions/my_fonctions_dump.php';
		$obj_my_fonctions_dump = new my_fonctions_dump ();
		// $a = $obj_my_fonctions_dump->dump_ob ( $this->configuration_utilisateur );
// 		$obj_my_fonctions_dump->dump_joli ( $_SERVER );
// 		$test = $obj_my_fonctions_dump->dump_ob ( $_SERVER );
//  		$test = $_SERVER;
// 		$obj_my_fonctions_dump->dump_joli ( $test );
// 		$obj_my_fonctions_dump->dump_joli ( $_SERVER );
// 		$obj_my_fonctions_dump->dump_joli ( $this->configuration_utilisateur );
// 		$obj_my_fonctions_dump->dump_joli ( $this->temp );
		
		// $_SESSION ['my_fonctions'] ['dump'] = new my_fonctions_dump ();
		// $_SESSION ['my_fonctions'] ['log']->logg ( 1, 0, "EMERG", "ALERT", "CRIT", "ERR", "WARN", "NOTICE", "INFO", "DEBUG-index", basename ( __DIR__ ), basename ( __FILE__ ), basename ( __FUNCTION__ ), basename ( __LINE__ ), log_recupere_parametres_fonction ( func_get_args () ), log_recupere_php_backtrace (), $_SESSION ['my_fonctions'] ['dump']->dd ( $_SESSION ) );
	}
	
	
	
	
	
	
	
	
	
				echo (APPLICATION_PATH . '/../library/api_externes/' . 'dump' . '/' . 'dump' . '.php');
			private function construct_my_fonctions_dump() {
		require_once APPLICATION_PATH . '/../library/my_fonctions/my_fonctions_dump.php';
		$obj_my_fonctions_dump = new my_fonctions_dump ();
		$a = $obj_my_fonctions_dump->dd_string ( $this->configuration_utilisateur );
		$obj_my_fonctions_dump->dd ( $a );
		// $_SESSION ['my_fonctions'] ['dump'] = new my_fonctions_dump ();
		// $_SESSION ['my_fonctions'] ['log']->logg ( 1, 0, "EMERG", "ALERT", "CRIT", "ERR", "WARN", "NOTICE", "INFO", "DEBUG-index", basename ( __DIR__ ), basename ( __FILE__ ), basename ( __FUNCTION__ ), basename ( __LINE__ ), log_recupere_parametres_fonction ( func_get_args () ), log_recupere_php_backtrace (), $_SESSION ['my_fonctions'] ['dump']->dd ( $_SESSION ) );
	}
			private function construct_my_fonctions_dump() {
		require_once APPLICATION_PATH . '/../library/my_fonctions/my_fonctions_dump.php';
		$obj_my_fonctions_dump = new my_fonctions_dump ();
// 		$a = $obj_my_fonctions_dump->dump_ob ( $this->configuration_utilisateur );
		$obj_my_fonctions_dump->dump_joli ( $this->configuration_utilisateur );
		// $_SESSION ['my_fonctions'] ['dump'] = new my_fonctions_dump ();
		// $_SESSION ['my_fonctions'] ['log']->logg ( 1, 0, "EMERG", "ALERT", "CRIT", "ERR", "WARN", "NOTICE", "INFO", "DEBUG-index", basename ( __DIR__ ), basename ( __FILE__ ), basename ( __FUNCTION__ ), basename ( __LINE__ ), log_recupere_parametres_fonction ( func_get_args () ), log_recupere_php_backtrace (), $_SESSION ['my_fonctions'] ['dump']->dd ( $_SESSION ) );
	}
		
		
		// throw new Exception("COQUILLE VIDE !");
throw new Exception(Zend_Debug::dump($application));
		throw new Exception(Zend_Debug::dump($_SESSION['koinkoin']));
		throw new Exception ( Zend_Debug::dump ( $_SESSION ) );
// throw new Exception(Zend_Debug::dump($var));

		$_SESSION ['my_fonctions'] ['dump']->dd ( $_SESSION );


		$_SESSION [$this->projet_configuration_utilisateur ['projet_nom_court']] ['configuration_utilisateur'] = $this->projet_configuration_utilisateur;
		throw new Exception(var_dump($_SESSION));


recupoerer un parametre ini a partir d'un controleur
// $bootstrap = $this->getInvokeArg('bootstrap');
// $db = $bootstrap->getResource('db');

/*
 * _ __ ____ _____ _ _ _ _ ____ _____ _ _
 * | |/ // __ \|_ _|| \ | || |/ // __ \|_ _|| \ | |
 * | ' /| | | | | | | \| || ' /| | | | | | | \| |
 * | < | | | | | | | . ` || < | | | | | | | . ` |
 * | . \| |__| |_| |_ | |\ || . \| |__| |_| |_ | |\ |___________
 * |_|\_\\____/|_____||_| \_||_|\_\\____/|_____||_| \_| \
 * | \
 * /\ Version : alpha.0.0.01 (Aout 2016) \
 * \_| Mail : koinkoin@dreamproject.fr \______________
 * | Doc : http;//dreamproject.fr/koinkoin/ \
 * | Synopsis : Koinkoin est un ensemble zend + mysql |
 * | qui vous permet d'automatiser la rï¿½cupï¿½reration de contenus du web |
 * | ___________________________________________________________________________ |_
 * \_/___________________________________________ Webscraping libre, opensource __/
 */

func_get_args ()




/*
 * @param  string                   $environment
 * @param  string|array|Zend_Config $options String path to configuration file, or array/Zend_Config of configuration options
 * @param bool $suppressNotFoundWarnings Should warnings be suppressed when a file is not found during autoloading?
 * @throws Zend_Application_Exception When invalid options are provided
 * @return void
 */







	private function initialise_my_fonctions() {
		require_once APPLICATION_PATH . '/../library/my_fonctions/my_fonctions.php';
		$_SESSION [$this->configuration_utilisateur ['head'] ['nom']] ['my_fonctions'] = new my_fonctions ();
		$_SESSION [$this->configuration_utilisateur ['head'] ['nom']] ['my_fonctions']->my_fonctions_to_obj ();
	}



		if (! isset ( $this->configuration_utilisateur ) || ! isset ( $this->configuration_demo )) {
			echo ('ERREUR CONFIG PROJET : les variables suivantes doivent etre dï¿½clarï¿½es : $this->configuration_utilisateur et $configuration_demo). De plus faire attention que les noms de variable dans le code ne soit pas changï¿½');
			die ();
		}
		if ($this->configuration_utilisateur === $this->configuration_demo) {
			echo 'configuration demo';
		}









	private function array_diff_key_recursive($tab_1, $tab_2) {
		$differences = array_diff_key ( $tab_2, $tab_1 ); // c projet_demo qui est ok et que l'on compare projet utilisateur (pas l'autre sens)
		$intersection = array_intersect_key ( $tab_1, $tab_2 );
		foreach ( $intersection as $cles => $val ) {
			if (is_array ( $tab_1 [$cles] ) && is_array ( $tab_2 [$cles] )) {
				$tab_3 = $this->array_diff_key_recursive ( $tab_1 [$cles], $tab_2 [$cles] );
				if ($tab_3) {
					$differences [$cles] = $tab_3;
				}
			}
		}
		return $differences;
	}
























// 		if (array_intersect ( $this->configuration_utilisateur, $configuration_demo )) {
// 			echo ('ERREUR CONFIG PROJET : la structure de projet_utilisateur et projet_demo ne peuvent pas etre diffï¿½rentes');
// 			die ();
// 		}

		// $tab_1 = array_diff ( $this->configuration_demo, $this->configuration_utilisateur );
		// if (! is_array ( $tab_1 ) && count ( array_diff ( $this->configuration_demo, $this->configuration_utilisateur ) != 0)) {
		// echo ('ERREUR CONFIG PROJET : les variables suivantes doivent etre dï¿½clarï¿½es : $this->configuration_utilisateur et $this->configuration_utilisateur)');
		// die ();
		// }




$tab_1 = $this->array_diff_key_recursive ( $this->configuration_projet ['projet_utilisateur'], $this->configuration_projet ['projet_demo'] );
		print_r ( $tab_1 );
		if (is_array ( $tab_1 ) && count ( $tab_1 ) != 0) {
			echo ('ERREUR CONFIG PROJET : les array projet_utilisateur et projet_demo ne peuvent pas etre diffï¿½rents dans leur structure)');
			die ();
		}
		
		// $test = $this->array_unique_diff ( $this->configuration_projet ['projet_utilisateur'], $this->configuration_projet ['projet_demo'] );
		// print_r ( $test );
		
		// var_dump ( $this->configuration_projet ['projet_demo'] );
		// $tab_2 = array_diff ( reset ( $this->configuration_projet ['projet_utilisateur'] ), prev ( $this->configuration_projet ['projet_demo'] ) );
		// var_dump ( $tab_2 );
		// if (is_array ( $tab_2 ) && count ( $tab_2 ) != 0) {
		// echo ('ERREUR CONFIG PROJET : les array projet_utilisateur et projet_demo ne peuvent pas etre diffï¿½rents dans leur donnees)');
		// die ();
		// }
		
		// if (array_intersect($array1, $array2);)){
		// echo ('ERREUR CONFIG PROJET : la structure de projet_utilisateur et projet_demo ne peuvent pas etre diffï¿½rentes');
		// die;
		
		// }
	






function recupere_php_backtrace() {
	ob_start ();
	var_dump ( debug_backtrace () );
	return ob_get_clean ();
}














<?php

function translateDate($date){

	$french = array('Aujourd\'hui', 'Hier');
	$english = array('Today', 'Yesterday');
	$date = str_replace($french, $english, $date);
	$date = strtotime($date);

	return $date;

};

include('simple_html_dom.php');

$url = 'http://www.leboncoin.fr/locations/offres/lorraine/meurthe_et_moselle/?f=p&th=1&mre=550&ret=1&ret=2&location=Nancy%2054000';
$html = file_get_html($url);

$annonces = array();

foreach($html->find('.list-lbc a') as $annonce){

	$annonce_id = parse_url($annonce->href);
	$annonce_id = $annonce_id['path'];
	$annonce_id = preg_match_all('!\d+!', $annonce_id, $matches);
	$annonce_id = $matches[0][0];

	$annonces[] = array(

		'id' => $annonce_id,
		'title' => trim($annonce->find('.lbc .detail .title', 0)->plaintext),
		'url' => $annonce->href,
		'timestamp' => translateDate(trim(strip_tags($annonce->find('.lbc .date', 0)->innertext))),
		'price' => trim($annonce->find('.lbc .detail .price', 0)->plaintext)	

		);

}

$last_annonce = $annonces[0]['timestamp'];

$annonces_new = $annonces;
$annonces_old = unserialize(file_get_contents('datas/annonces.txt'));

function udiffCompare($a, $b){

	return $a['id'] - $b['id'];

}

$diff = array_udiff($annonces_new, $annonces_old, 'udiffCompare');

if (!empty($diff)){

	$i = 1;

	foreach ($diff as $result) {

		echo '#'.$i++.' Publiï¿½e le '.date("d/m/y ï¿½ H:i", $result['timestamp']).' : <a href="'.$result['url'].'" target="_blank">'.$result['title'].' ('.$result['price'].')</a><hr>';

	}

	file_put_contents('datas/annonces.txt', serialize($annonces));

} else {

	echo 'Pas de nouvelles annonces depuis le '.date('d/m/y ï¿½ H:i', $last_annonce).' !';

}

?>













	private function library_v_include_api_externes() {
		if (API_NAME_CURL != '') {
			require_once '../library/V/' . PROJET_VERSION . '/curl/api_externes_curl/' . API_NAME_CURL . '_curl/index.php';
			// echo "ok curl";
		} else {
			// echo "PROBLEME AVEC curl";
		}
		
		if (API_NAME_REGEX != '') {
			require_once '../library/V/' . PROJET_VERSION . '/regex/api_externes_regex/' . API_NAME_REGEX . '_regex/index.php';
			// echo "ok regex";
		} else {
			// echo "PROBLEME AVEC API_NAME_REGEX";
		}
		
		if (API_NAME_SESSION != '') {
			require_once '../library/V/' . PROJET_VERSION . '/session/api_externes_session/' . API_NAME_SESSION . '_session/index.php';
		} else {
			// echo "PROBLEME AVEC API_NAME_SESSIONS";
		}
		
		if (API_NAME_XPATH != '') {
			require_once '../library/V/' . PROJET_VERSION . '/xpath/api_externes_xpath/' . API_NAME_XPATH . '_xpath/index.php';
		} else {
			// echo "PROBLEME AVEC API_NAME_XPATH";
		}
		
		if (API_NAME_LOG != '') {
			throw new Exception ( Zend_Debug::dump ( "API_NAME_LOG" ) );
			
			require_once '../library/V/' . PROJET_VERSION . '/log/api_externes_log/' . API_NAME_XPATH . '_log/index.php'; // TODO: a corriger c pas xpath
		} else {
			// echo "PROBLEME AVEC API_NAME_LOG";
		}
		
		// if (API_NAME_TEMPLATE != '') {
		// throw new Exception ( Zend_Debug::dump ( "API_NAME_TEMPLATE" ) );
		
		// require_once '../library/V/' . PROJET_VERSION . '/log/api_externes_template/' . API_NAME_TEMPLATE . '_template/index.php';
		// } else {
		// // echo "PROBLEME AVEC API_NAME_LOG";
		// }
		
		// if (API_NAME_DUMP <> '')
		// {
		// require_once '../library/V/'.PROJET_VERSION.'/dump/api_externes_dump/'.API_NAME_DUMP.'_dump/index.php';
		// }
	}






























































































a:35:{i:0;a:5:{s:2:"id";s:9:"421547691";s:5:"title";s:48:"F1 bis axe jean jaures / tramway/ cour privative";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421547691.htm?ca=15_s";s:9:"timestamp";i:1358519160;s:5:"price";s:15:"400&nbsp;&euro;";}i:1;a:5:{s:2:"id";s:9:"417421386";s:5:"title";s:37:"F3 nancy rue gabriel mouilleron nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417421386.htm?ca=15_s";s:9:"timestamp";i:1358517900;s:5:"price";s:15:"490&nbsp;&euro;";}i:2;a:5:{s:2:"id";s:9:"417428243";s:5:"title";s:47:"F2 nancy rue de la salle proche hopital central";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417428243.htm?ca=15_s";s:9:"timestamp";i:1358517120;s:5:"price";s:15:"450&nbsp;&euro;";}i:3;a:5:{s:2:"id";s:9:"418665861";s:5:"title";s:25:"Appartement F2 NANCY 41m2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/418665861.htm?ca=15_s";s:9:"timestamp";i:1358516340;s:5:"price";s:15:"500&nbsp;&euro;";}i:4;a:5:{s:2:"id";s:9:"414934361";s:5:"title";s:15:"Location studio";s:3:"url";s:55:"http://www.leboncoin.fr/locations/414934361.htm?ca=15_s";s:9:"timestamp";i:1358512320;s:5:"price";s:15:"350&nbsp;&euro;";}i:5;a:5:{s:2:"id";s:9:"421486388";s:5:"title";s:13:"Maginfique F3";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421486388.htm?ca=15_s";s:9:"timestamp";i:1358511840;s:5:"price";s:15:"550&nbsp;&euro;";}i:6;a:5:{s:2:"id";s:9:"421479122";s:5:"title";s:44:"F2 40 m2 NANCY CENTRE + Parking priv&eacute;";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421479122.htm?ca=15_s";s:9:"timestamp";i:1358510700;s:5:"price";s:15:"500&nbsp;&euro;";}i:7;a:5:{s:2:"id";s:9:"417743640";s:5:"title";s:12:"F2&#45;Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417743640.htm?ca=15_s";s:9:"timestamp";i:1358507940;s:5:"price";s:15:"470&nbsp;&euro;";}i:8;a:5:{s:2:"id";s:9:"412251803";s:5:"title";s:33:"F1 NANCY Quartier IUT Charlemagne";s:3:"url";s:55:"http://www.leboncoin.fr/locations/412251803.htm?ca=15_s";s:9:"timestamp";i:1358506320;s:5:"price";s:15:"400&nbsp;&euro;";}i:9;a:5:{s:2:"id";s:9:"418148476";s:5:"title";s:53:"Beau T2 meubl&eacute; secteur Nancy Cath&eacute;drale";s:3:"url";s:55:"http://www.leboncoin.fr/locations/418148476.htm?ca=15_s";s:9:"timestamp";i:1358505840;s:5:"price";s:15:"550&nbsp;&euro;";}i:10;a:5:{s:2:"id";s:9:"407640096";s:5:"title";s:52:"Nancy appart recent de qualit&eacute; garage terasse";s:3:"url";s:55:"http://www.leboncoin.fr/locations/407640096.htm?ca=15_s";s:9:"timestamp";i:1358503920;s:5:"price";s:15:"495&nbsp;&euro;";}i:11;a:5:{s:2:"id";s:9:"412227706";s:5:"title";s:39:"Grand F3 calme en plein cenre&#45;ville";s:3:"url";s:55:"http://www.leboncoin.fr/locations/412227706.htm?ca=15_s";s:9:"timestamp";i:1358503380;s:5:"price";s:15:"530&nbsp;&euro;";}i:12;a:5:{s:2:"id";s:9:"403769406";s:5:"title";s:21:"Studio &agrave; NANCY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/403769406.htm?ca=15_s";s:9:"timestamp";i:1358502660;s:5:"price";s:15:"400&nbsp;&euro;";}i:13;a:5:{s:2:"id";s:9:"421406560";s:5:"title";s:21:"F2 Hyper centre Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421406560.htm?ca=15_s";s:9:"timestamp";i:1358500080;s:5:"price";s:15:"550&nbsp;&euro;";}i:14;a:5:{s:2:"id";s:9:"419034830";s:5:"title";s:36:"F1 au centre de Nancy &agrave; louer";s:3:"url";s:55:"http://www.leboncoin.fr/locations/419034830.htm?ca=15_s";s:9:"timestamp";i:1358499600;s:5:"price";s:15:"395&nbsp;&euro;";}i:15;a:5:{s:2:"id";s:9:"421393785";s:5:"title";s:57:"F2 &agrave; Nancy rue de la Colline proche fac de lettres";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421393785.htm?ca=15_s";s:9:"timestamp";i:1358498280;s:5:"price";s:15:"435&nbsp;&euro;";}i:16;a:5:{s:2:"id";s:9:"421365412";s:5:"title";s:13:"F2 clemenceau";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421365412.htm?ca=15_s";s:9:"timestamp";i:1358493420;s:5:"price";s:15:"480&nbsp;&euro;";}i:17;a:5:{s:2:"id";s:9:"388249719";s:5:"title";s:15:"F2 f1 bis nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/388249719.htm?ca=15_s";s:9:"timestamp";i:1358492580;s:5:"price";s:15:"430&nbsp;&euro;";}i:18;a:5:{s:2:"id";s:9:"420922055";s:5:"title";s:48:"Location F3 rue R Poincar&eacute; &agrave; Nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/420922055.htm?ca=15_s";s:9:"timestamp";i:1358492100;s:5:"price";s:15:"475&nbsp;&euro;";}i:19;a:5:{s:2:"id";s:9:"421329869";s:5:"title";s:46:"APPARTEMENT F2 BIS NANCY GARE , secteur ISABEY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421329869.htm?ca=15_s";s:9:"timestamp";i:1358474100;s:5:"price";s:15:"485&nbsp;&euro;";}i:20;a:5:{s:2:"id";s:9:"316405516";s:5:"title";s:24:"F1 F1 T1 bis f2 F2 nancy";s:3:"url";s:55:"http://www.leboncoin.fr/locations/316405516.htm?ca=15_s";s:9:"timestamp";i:1358467500;s:5:"price";s:15:"430&nbsp;&euro;";}i:21;a:5:{s:2:"id";s:9:"410723600";s:5:"title";s:42:"Nancy ville vieille rue du ht bourgeois f2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/410723600.htm?ca=15_s";s:9:"timestamp";i:1358466900;s:5:"price";s:15:"425&nbsp;&euro;";}i:22;a:5:{s:2:"id";s:9:"413306095";s:5:"title";s:23:"Studio quartier Blandan";s:3:"url";s:55:"http://www.leboncoin.fr/locations/413306095.htm?ca=15_s";s:9:"timestamp";i:1358464800;s:5:"price";s:15:"320&nbsp;&euro;";}i:23;a:5:{s:2:"id";s:9:"421310656";s:5:"title";s:12:"F1 bis NANCY";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421310656.htm?ca=15_s";s:9:"timestamp";i:1358464740;s:5:"price";s:15:"385&nbsp;&euro;";}i:24;a:5:{s:2:"id";s:9:"415237939";s:5:"title";s:28:"Nancy quartier cathedrale f1";s:3:"url";s:55:"http://www.leboncoin.fr/locations/415237939.htm?ca=15_s";s:9:"timestamp";i:1358462940;s:5:"price";s:15:"365&nbsp;&euro;";}i:25;a:5:{s:2:"id";s:9:"421294125";s:5:"title";s:22:"F1 Duplex Nancy Centre";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421294125.htm?ca=15_s";s:9:"timestamp";i:1358458800;s:5:"price";s:15:"400&nbsp;&euro;";}i:26;a:5:{s:2:"id";s:9:"417992115";s:5:"title";s:2:"F2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/417992115.htm?ca=15_s";s:9:"timestamp";i:1358458620;s:5:"price";s:15:"459&nbsp;&euro;";}i:27;a:5:{s:2:"id";s:9:"421258405";s:5:"title";s:25:"F1 bis rue Kleber (nancy)";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421258405.htm?ca=15_s";s:9:"timestamp";i:1358453760;s:5:"price";s:15:"395&nbsp;&euro;";}i:28;a:5:{s:2:"id";s:9:"421247962";s:5:"title";s:35:"Nancy location studio meubl&eacute;";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421247962.htm?ca=15_s";s:9:"timestamp";i:1358451960;s:5:"price";s:15:"300&nbsp;&euro;";}i:29;a:5:{s:2:"id";s:9:"390276837";s:5:"title";s:75:"F1 Nancy &#45; 24 m2 &#45; proche &eacute;coles et fac &#45; Nab&eacute;cor";s:3:"url";s:55:"http://www.leboncoin.fr/locations/390276837.htm?ca=15_s";s:9:"timestamp";i:1358451300;s:5:"price";s:15:"330&nbsp;&euro;";}i:30;a:5:{s:2:"id";s:9:"414663874";s:5:"title";s:6:"Studio";s:3:"url";s:55:"http://www.leboncoin.fr/locations/414663874.htm?ca=15_s";s:9:"timestamp";i:1358449380;s:5:"price";s:15:"350&nbsp;&euro;";}i:31;a:5:{s:2:"id";s:9:"421191157";s:5:"title";s:51:"STUDIO tout&#45;&eacute;quip&eacute; &agrave; louer";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421191157.htm?ca=15_s";s:9:"timestamp";i:1358444340;s:5:"price";s:15:"380&nbsp;&euro;";}i:32;a:5:{s:2:"id";s:9:"421185728";s:5:"title";s:19:"F2+terrasse 500euro";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421185728.htm?ca=15_s";s:9:"timestamp";i:1358443980;s:5:"price";s:15:"500&nbsp;&euro;";}i:33;a:5:{s:2:"id";s:9:"421170481";s:5:"title";s:6:"F2 bis";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421170481.htm?ca=15_s";s:9:"timestamp";i:1358442660;s:5:"price";s:15:"520&nbsp;&euro;";}i:34;a:5:{s:2:"id";s:9:"421143578";s:5:"title";s:49:"T2 meubl&eacute; Rue D&eacute;silles (Nancy) 48m2";s:3:"url";s:55:"http://www.leboncoin.fr/locations/421143578.htm?ca=15_s";s:9:"timestamp";i:1358438880;s:5:"price";s:15:"550&nbsp;&euro;";}}
























































































<?php
/**
 * Website: http://sourceforge.net/projects/simplehtmldom/
 * Additional projects that may be used: http://sourceforge.net/projects/debugobject/
 * Acknowledge: Jose Solorzano (https://sourceforge.net/projects/php-html/)
 * Contributions by:
 *	 Yousuke Kumakura (Attribute filters)
 *	 Vadim Voituk (Negative indexes supports of "find" method)
 *	 Antcs (Constructor with automatically load contents either text or file/url)
 *
 * all affected sections have comments starting with "PaperG"
 *
 * Paperg - Added case insensitive testing of the value of the selector.
 * Paperg - Added tag_start for the starting index of tags - NOTE: This works but not accurately.
 *  This tag_start gets counted AFTER \r\n have been crushed out, and after the remove_noice calls so it will not reflect the REAL position of the tag in the source,
 *  it will almost always be smaller by some amount.
 *  We use this to determine how far into the file the tag in question is.  This "percentage will never be accurate as the $dom->size is the "real" number of bytes the dom was created from.
 *  but for most purposes, it's a really good estimation.
 * Paperg - Added the forceTagsClosed to the dom constructor.  Forcing tags closed is great for malformed html, but it CAN lead to parsing errors.
 * Allow the user to tell us how much they trust the html.
 * Paperg add the text and plaintext to the selectors for the find syntax.  plaintext implies text in the innertext of a node.  text implies that the tag is a text node.
 * This allows for us to find tags based on the text they contain.
 * Create find_ancestor_tag to see if a tag is - at any level - inside of another specific tag.
 * Paperg: added parse_charset so that we know about the character set of the source document.
 *  NOTE:  If the user's system has a routine called get_last_retrieve_url_contents_content_type availalbe, we will assume it's returning the content-type header from the
 *  last transfer or curl_exec, and we will parse that and use it in preference to any other method of charset detection.
 *
 * Found infinite loop in the case of broken html in restore_noise.  Rewrote to protect from that.
 * PaperG (John Schlick) Added get_display_size for "IMG" tags.
 *
 * Licensed under The MIT License
 * Redistributions of files must retain the above copyright notice.
 *
 * @author S.C. Chen <me578022@gmail.com>
 * @author John Schlick
 * @author Rus Carroll
 * @version 1.5 ($Rev: 202 $)
 * @package PlaceLocalInclude
 * @subpackage simple_html_dom
 */

/**
 * All of the Defines for the classes below.
 * @author S.C. Chen <me578022@gmail.com>
 */
define('HDOM_TYPE_ELEMENT', 1);
define('HDOM_TYPE_COMMENT', 2);
define('HDOM_TYPE_TEXT',	3);
define('HDOM_TYPE_ENDTAG',  4);
define('HDOM_TYPE_ROOT',	5);
define('HDOM_TYPE_UNKNOWN', 6);
define('HDOM_QUOTE_DOUBLE', 0);
define('HDOM_QUOTE_SINGLE', 1);
define('HDOM_QUOTE_NO',	 3);
define('HDOM_INFO_BEGIN',   0);
define('HDOM_INFO_END',	 1);
define('HDOM_INFO_QUOTE',   2);
define('HDOM_INFO_SPACE',   3);
define('HDOM_INFO_TEXT',	4);
define('HDOM_INFO_INNER',   5);
define('HDOM_INFO_OUTER',   6);
define('HDOM_INFO_ENDSPACE',7);
define('DEFAULT_TARGET_CHARSET', 'UTF-8');
define('DEFAULT_BR_TEXT', "\r\n");
define('DEFAULT_SPAN_TEXT', " ");
define('MAX_FILE_SIZE', 600000);
// helper functions
// -----------------------------------------------------------------------------
// get html dom from file
// $maxlen is defined in the code as PHP_STREAM_COPY_ALL which is defined as -1.
function file_get_html($url, $use_include_path = false, $context=null, $offset = -1, $maxLen=-1, $lowercase = true, $forceTagsClosed=true, $target_charset = DEFAULT_TARGET_CHARSET, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT, $defaultSpanText=DEFAULT_SPAN_TEXT)
{
	// We DO force the tags to be terminated.
	$dom = new simple_html_dom(null, $lowercase, $forceTagsClosed, $target_charset, $stripRN, $defaultBRText, $defaultSpanText);
	// For sourceforge users: uncomment the next line and comment the retreive_url_contents line 2 lines down if it is not already done.
	$contents = file_get_contents($url, $use_include_path, $context, $offset);
	// Paperg - use our own mechanism for getting the contents as we want to control the timeout.
	//$contents = retrieve_url_contents($url);
	if (empty($contents) || strlen($contents) > MAX_FILE_SIZE)
	{
		return false;
	}
	// The second parameter can force the selectors to all be lowercase.
	$dom->load($contents, $lowercase, $stripRN);
	return $dom;
}

// get html dom from string
function str_get_html($str, $lowercase=true, $forceTagsClosed=true, $target_charset = DEFAULT_TARGET_CHARSET, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT, $defaultSpanText=DEFAULT_SPAN_TEXT)
{
	$dom = new simple_html_dom(null, $lowercase, $forceTagsClosed, $target_charset, $stripRN, $defaultBRText, $defaultSpanText);
	if (empty($str) || strlen($str) > MAX_FILE_SIZE)
	{
		$dom->clear();
		return false;
	}
	$dom->load($str, $lowercase, $stripRN);
	return $dom;
}

// dump html dom tree
function dump_html_tree($node, $show_attr=true, $deep=0)
{
	$node->dump($node);
}


/**
 * simple html dom node
 * PaperG - added ability for "find" routine to lowercase the value of the selector.
 * PaperG - added $tag_start to track the start position of the tag in the total byte index
 *
 * @package PlaceLocalInclude
 */
class simple_html_dom_node
{
	public $nodetype = HDOM_TYPE_TEXT;
	public $tag = 'text';
	public $attr = array();
	public $children = array();
	public $nodes = array();
	public $parent = null;
	// The "info" array - see HDOM_INFO_... for what each element contains.
	public $_ = array();
	public $tag_start = 0;
	private $dom = null;

	function __construct($dom)
	{
		$this->dom = $dom;
		$dom->nodes[] = $this;
	}

	function __destruct()
	{
		$this->clear();
	}

	function __toString()
	{
		return $this->outertext();
	}

	// clean up memory due to php5 circular references memory leak...
	function clear()
	{
		$this->dom = null;
		$this->nodes = null;
		$this->parent = null;
		$this->children = null;
	}

	// dump node's tree
	function dump($show_attr=true, $deep=0)
	{
		$lead = str_repeat('	', $deep);

		echo $lead.$this->tag;
		if ($show_attr && count($this->attr)>0)
		{
			echo '(';
			foreach ($this->attr as $k=>$v)
				echo "[$k]=>\"".$this->$k.'", ';
			echo ')';
		}
		echo "\n";

		if ($this->nodes)
		{
			foreach ($this->nodes as $c)
			{
				$c->dump($show_attr, $deep+1);
			}
		}
	}


	// Debugging function to dump a single dom node with a bunch of information about it.
	function dump_node($echo=true)
	{

		$string = $this->tag;
		if (count($this->attr)>0)
		{
			$string .= '(';
			foreach ($this->attr as $k=>$v)
			{
				$string .= "[$k]=>\"".$this->$k.'", ';
			}
			$string .= ')';
		}
		if (count($this->_)>0)
		{
			$string .= ' $_ (';
			foreach ($this->_ as $k=>$v)
			{
				if (is_array($v))
				{
					$string .= "[$k]=>(";
					foreach ($v as $k2=>$v2)
					{
						$string .= "[$k2]=>\"".$v2.'", ';
					}
					$string .= ")";
				} else {
					$string .= "[$k]=>\"".$v.'", ';
				}
			}
			$string .= ")";
		}

		if (isset($this->text))
		{
			$string .= " text: (" . $this->text . ")";
		}

		$string .= " HDOM_INNER_INFO: '";
		if (isset($node->_[HDOM_INFO_INNER]))
		{
			$string .= $node->_[HDOM_INFO_INNER] . "'";
		}
		else
		{
			$string .= ' NULL ';
		}

		$string .= " children: " . count($this->children);
		$string .= " nodes: " . count($this->nodes);
		$string .= " tag_start: " . $this->tag_start;
		$string .= "\n";

		if ($echo)
		{
			echo $string;
			return;
		}
		else
		{
			return $string;
		}
	}

	// returns the parent of node
	// If a node is passed in, it will reset the parent of the current node to that one.
	function parent($parent=null)
	{
		// I am SURE that this doesn't work properly.
		// It fails to unset the current node from it's current parents nodes or children list first.
		if ($parent !== null)
		{
			$this->parent = $parent;
			$this->parent->nodes[] = $this;
			$this->parent->children[] = $this;
		}

		return $this->parent;
	}

	// verify that node has children
	function has_child()
	{
		return !empty($this->children);
	}

	// returns children of node
	function children($idx=-1)
	{
		if ($idx===-1)
		{
			return $this->children;
		}
		if (isset($this->children[$idx])) return $this->children[$idx];
		return null;
	}

	// returns the first child of node
	function first_child()
	{
		if (count($this->children)>0)
		{
			return $this->children[0];
		}
		return null;
	}

	// returns the last child of node
	function last_child()
	{
		if (($count=count($this->children))>0)
		{
			return $this->children[$count-1];
		}
		return null;
	}

	// returns the next sibling of node
	function next_sibling()
	{
		if ($this->parent===null)
		{
			return null;
		}

		$idx = 0;
		$count = count($this->parent->children);
		while ($idx<$count && $this!==$this->parent->children[$idx])
		{
			++$idx;
		}
		if (++$idx>=$count)
		{
			return null;
		}
		return $this->parent->children[$idx];
	}

	// returns the previous sibling of node
	function prev_sibling()
	{
		if ($this->parent===null) return null;
		$idx = 0;
		$count = count($this->parent->children);
		while ($idx<$count && $this!==$this->parent->children[$idx])
			++$idx;
		if (--$idx<0) return null;
		return $this->parent->children[$idx];
	}

	// function to locate a specific ancestor tag in the path to the root.
	function find_ancestor_tag($tag)
	{
		global $debug_object;
		if (is_object($debug_object)) { $debug_object->debugLogEntry(1); }

		// Start by including ourselves in the comparison.
		$returnDom = $this;

		while (!is_null($returnDom))
		{
			if (is_object($debug_object)) { $debug_object->debugLog(2, "Current tag is: " . $returnDom->tag); }

			if ($returnDom->tag == $tag)
			{
				break;
			}
			$returnDom = $returnDom->parent;
		}
		return $returnDom;
	}

	// get dom node's inner html
	function innertext()
	{
		if (isset($this->_[HDOM_INFO_INNER])) return $this->_[HDOM_INFO_INNER];
		if (isset($this->_[HDOM_INFO_TEXT])) return $this->dom->restore_noise($this->_[HDOM_INFO_TEXT]);

		$ret = '';
		foreach ($this->nodes as $n)
			$ret .= $n->outertext();
		return $ret;
	}

	// get dom node's outer text (with tag)
	function outertext()
	{
		global $debug_object;
		if (is_object($debug_object))
		{
			$text = '';
			if ($this->tag == 'text')
			{
				if (!empty($this->text))
				{
					$text = " with text: " . $this->text;
				}
			}
			$debug_object->debugLog(1, 'Innertext of tag: ' . $this->tag . $text);
		}

		if ($this->tag==='root') return $this->innertext();

		// trigger callback
		if ($this->dom && $this->dom->callback!==null)
		{
			call_user_func_array($this->dom->callback, array($this));
		}

		if (isset($this->_[HDOM_INFO_OUTER])) return $this->_[HDOM_INFO_OUTER];
		if (isset($this->_[HDOM_INFO_TEXT])) return $this->dom->restore_noise($this->_[HDOM_INFO_TEXT]);

		// render begin tag
		if ($this->dom && $this->dom->nodes[$this->_[HDOM_INFO_BEGIN]])
		{
			$ret = $this->dom->nodes[$this->_[HDOM_INFO_BEGIN]]->makeup();
		} else {
			$ret = "";
		}

		// render inner text
		if (isset($this->_[HDOM_INFO_INNER]))
		{
			// If it's a br tag...  don't return the HDOM_INNER_INFO that we may or may not have added.
			if ($this->tag != "br")
			{
				$ret .= $this->_[HDOM_INFO_INNER];
			}
		} else {
			if ($this->nodes)
			{
				foreach ($this->nodes as $n)
				{
					$ret .= $this->convert_text($n->outertext());
				}
			}
		}

		// render end tag
		if (isset($this->_[HDOM_INFO_END]) && $this->_[HDOM_INFO_END]!=0)
			$ret .= '</'.$this->tag.'>';
		return $ret;
	}

	// get dom node's plain text
	function text()
	{
		if (isset($this->_[HDOM_INFO_INNER])) return $this->_[HDOM_INFO_INNER];
		switch ($this->nodetype)
		{
			case HDOM_TYPE_TEXT: return $this->dom->restore_noise($this->_[HDOM_INFO_TEXT]);
			case HDOM_TYPE_COMMENT: return '';
			case HDOM_TYPE_UNKNOWN: return '';
		}
		if (strcasecmp($this->tag, 'script')===0) return '';
		if (strcasecmp($this->tag, 'style')===0) return '';

		$ret = '';
		// In rare cases, (always node type 1 or HDOM_TYPE_ELEMENT - observed for some span tags, and some p tags) $this->nodes is set to NULL.
		// NOTE: This indicates that there is a problem where it's set to NULL without a clear happening.
		// WHY is this happening?
		if (!is_null($this->nodes))
		{
			foreach ($this->nodes as $n)
			{
				$ret .= $this->convert_text($n->text());
			}

			// If this node is a span... add a space at the end of it so multiple spans don't run into each other.  This is plaintext after all.
			if ($this->tag == "span")
			{
				$ret .= $this->dom->default_span_text;
			}


		}
		return $ret;
	}

	function xmltext()
	{
		$ret = $this->innertext();
		$ret = str_ireplace('<![CDATA[', '', $ret);
		$ret = str_replace(']]>', '', $ret);
		return $ret;
	}

	// build node's text with tag
	function makeup()
	{
		// text, comment, unknown
		if (isset($this->_[HDOM_INFO_TEXT])) return $this->dom->restore_noise($this->_[HDOM_INFO_TEXT]);

		$ret = '<'.$this->tag;
		$i = -1;

		foreach ($this->attr as $key=>$val)
		{
			++$i;

			// skip removed attribute
			if ($val===null || $val===false)
				continue;

			$ret .= $this->_[HDOM_INFO_SPACE][$i][0];
			//no value attr: nowrap, checked selected...
			if ($val===true)
				$ret .= $key;
			else {
				switch ($this->_[HDOM_INFO_QUOTE][$i])
				{
					case HDOM_QUOTE_DOUBLE: $quote = '"'; break;
					case HDOM_QUOTE_SINGLE: $quote = '\''; break;
					default: $quote = '';
				}
				$ret .= $key.$this->_[HDOM_INFO_SPACE][$i][1].'='.$this->_[HDOM_INFO_SPACE][$i][2].$quote.$val.$quote;
			}
		}
		$ret = $this->dom->restore_noise($ret);
		return $ret . $this->_[HDOM_INFO_ENDSPACE] . '>';
	}

	// find elements by css selector
	//PaperG - added ability for find to lowercase the value of the selector.
	function find($selector, $idx=null, $lowercase=false)
	{
		$selectors = $this->parse_selector($selector);
		if (($count=count($selectors))===0) return array();
		$found_keys = array();

		// find each selector
		for ($c=0; $c<$count; ++$c)
		{
			// The change on the below line was documented on the sourceforge code tracker id 2788009
			// used to be: if (($levle=count($selectors[0]))===0) return array();
			if (($levle=count($selectors[$c]))===0) return array();
			if (!isset($this->_[HDOM_INFO_BEGIN])) return array();

			$head = array($this->_[HDOM_INFO_BEGIN]=>1);

			// handle descendant selectors, no recursive!
			for ($l=0; $l<$levle; ++$l)
			{
				$ret = array();
				foreach ($head as $k=>$v)
				{
					$n = ($k===-1) ? $this->dom->root : $this->dom->nodes[$k];
					//PaperG - Pass this optional parameter on to the seek function.
					$n->seek($selectors[$c][$l], $ret, $lowercase);
				}
				$head = $ret;
			}

			foreach ($head as $k=>$v)
			{
				if (!isset($found_keys[$k]))
					$found_keys[$k] = 1;
			}
		}

		// sort keys
		ksort($found_keys);

		$found = array();
		foreach ($found_keys as $k=>$v)
			$found[] = $this->dom->nodes[$k];

		// return nth-element or array
		if (is_null($idx)) return $found;
		else if ($idx<0) $idx = count($found) + $idx;
		return (isset($found[$idx])) ? $found[$idx] : null;
	}

	// seek for given conditions
	// PaperG - added parameter to allow for case insensitive testing of the value of a selector.
	protected function seek($selector, &$ret, $lowercase=false)
	{
		global $debug_object;
		if (is_object($debug_object)) { $debug_object->debugLogEntry(1); }

		list($tag, $key, $val, $exp, $no_key) = $selector;

		// xpath index
		if ($tag && $key && is_numeric($key))
		{
			$count = 0;
			foreach ($this->children as $c)
			{
				if ($tag==='*' || $tag===$c->tag) {
					if (++$count==$key) {
						$ret[$c->_[HDOM_INFO_BEGIN]] = 1;
						return;
					}
				}
			}
			return;
		}

		$end = (!empty($this->_[HDOM_INFO_END])) ? $this->_[HDOM_INFO_END] : 0;
		if ($end==0) {
			$parent = $this->parent;
			while (!isset($parent->_[HDOM_INFO_END]) && $parent!==null) {
				$end -= 1;
				$parent = $parent->parent;
			}
			$end += $parent->_[HDOM_INFO_END];
		}

		for ($i=$this->_[HDOM_INFO_BEGIN]+1; $i<$end; ++$i) {
			$node = $this->dom->nodes[$i];

			$pass = true;

			if ($tag==='*' && !$key) {
				if (in_array($node, $this->children, true))
					$ret[$i] = 1;
				continue;
			}

			// compare tag
			if ($tag && $tag!=$node->tag && $tag!=='*') {$pass=false;}
			// compare key
			if ($pass && $key) {
				if ($no_key) {
					if (isset($node->attr[$key])) $pass=false;
				} else {
					if (($key != "plaintext") && !isset($node->attr[$key])) $pass=false;
				}
			}
			// compare value
			if ($pass && $key && $val  && $val!=='*') {
				// If they have told us that this is a "plaintext" search then we want the plaintext of the node - right?
				if ($key == "plaintext") {
					// $node->plaintext actually returns $node->text();
					$nodeKeyValue = $node->text();
				} else {
					// this is a normal search, we want the value of that attribute of the tag.
					$nodeKeyValue = $node->attr[$key];
				}
				if (is_object($debug_object)) {$debug_object->debugLog(2, "testing node: " . $node->tag . " for attribute: " . $key . $exp . $val . " where nodes value is: " . $nodeKeyValue);}

				//PaperG - If lowercase is set, do a case insensitive test of the value of the selector.
				if ($lowercase) {
					$check = $this->match($exp, strtolower($val), strtolower($nodeKeyValue));
				} else {
					$check = $this->match($exp, $val, $nodeKeyValue);
				}
				if (is_object($debug_object)) {$debug_object->debugLog(2, "after match: " . ($check ? "true" : "false"));}

				// handle multiple class
				if (!$check && strcasecmp($key, 'class')===0) {
					foreach (explode(' ',$node->attr[$key]) as $k) {
						// Without this, there were cases where leading, trailing, or double spaces lead to our comparing blanks - bad form.
						if (!empty($k)) {
							if ($lowercase) {
								$check = $this->match($exp, strtolower($val), strtolower($k));
							} else {
								$check = $this->match($exp, $val, $k);
							}
							if ($check) break;
						}
					}
				}
				if (!$check) $pass = false;
			}
			if ($pass) $ret[$i] = 1;
			unset($node);
		}
		// It's passed by reference so this is actually what this function returns.
		if (is_object($debug_object)) {$debug_object->debugLog(1, "EXIT - ret: ", $ret);}
	}

	protected function match($exp, $pattern, $value) {
		global $debug_object;
		if (is_object($debug_object)) {$debug_object->debugLogEntry(1);}

		switch ($exp) {
			case '=':
				return ($value===$pattern);
			case '!=':
				return ($value!==$pattern);
			case '^=':
				return preg_match("/^".preg_quote($pattern,'/')."/", $value);
			case '$=':
				return preg_match("/".preg_quote($pattern,'/')."$/", $value);
			case '*=':
				if ($pattern[0]=='/') {
					return preg_match($pattern, $value);
				}
				return preg_match("/".$pattern."/i", $value);
		}
		return false;
	}

	protected function parse_selector($selector_string) {
		global $debug_object;
		if (is_object($debug_object)) {$debug_object->debugLogEntry(1);}

		// pattern of CSS selectors, modified from mootools
		// Paperg: Add the colon to the attrbute, so that it properly finds <tag attr:ibute="something" > like google does.
		// Note: if you try to look at this attribute, yo MUST use getAttribute since $dom->x:y will fail the php syntax check.
// Notice the \[ starting the attbute?  and the @? following?  This implies that an attribute can begin with an @ sign that is not captured.
// This implies that an html attribute specifier may start with an @ sign that is NOT captured by the expression.
// farther study is required to determine of this should be documented or removed.
//		$pattern = "/([\w-:\*]*)(?:\#([\w-]+)|\.([\w-]+))?(?:\[@?(!?[\w-]+)(?:([!*^$]?=)[\"']?(.*?)[\"']?)?\])?([\/, ]+)/is";
		$pattern = "/([\w-:\*]*)(?:\#([\w-]+)|\.([\w-]+))?(?:\[@?(!?[\w-:]+)(?:([!*^$]?=)[\"']?(.*?)[\"']?)?\])?([\/, ]+)/is";
		preg_match_all($pattern, trim($selector_string).' ', $matches, PREG_SET_ORDER);
		if (is_object($debug_object)) {$debug_object->debugLog(2, "Matches Array: ", $matches);}

		$selectors = array();
		$result = array();
		//print_r($matches);

		foreach ($matches as $m) {
			$m[0] = trim($m[0]);
			if ($m[0]==='' || $m[0]==='/' || $m[0]==='//') continue;
			// for browser generated xpath
			if ($m[1]==='tbody') continue;

			list($tag, $key, $val, $exp, $no_key) = array($m[1], null, null, '=', false);
			if (!empty($m[2])) {$key='id'; $val=$m[2];}
			if (!empty($m[3])) {$key='class'; $val=$m[3];}
			if (!empty($m[4])) {$key=$m[4];}
			if (!empty($m[5])) {$exp=$m[5];}
			if (!empty($m[6])) {$val=$m[6];}

			// convert to lowercase
			if ($this->dom->lowercase) {$tag=strtolower($tag); $key=strtolower($key);}
			//elements that do NOT have the specified attribute
			if (isset($key[0]) && $key[0]==='!') {$key=substr($key, 1); $no_key=true;}

			$result[] = array($tag, $key, $val, $exp, $no_key);
			if (trim($m[7])===',') {
				$selectors[] = $result;
				$result = array();
			}
		}
		if (count($result)>0)
			$selectors[] = $result;
		return $selectors;
	}

	function __get($name) {
		if (isset($this->attr[$name]))
		{
			return $this->convert_text($this->attr[$name]);
		}
		switch ($name) {
			case 'outertext': return $this->outertext();
			case 'innertext': return $this->innertext();
			case 'plaintext': return $this->text();
			case 'xmltext': return $this->xmltext();
			default: return array_key_exists($name, $this->attr);
		}
	}

	function __set($name, $value) {
		switch ($name) {
			case 'outertext': return $this->_[HDOM_INFO_OUTER] = $value;
			case 'innertext':
				if (isset($this->_[HDOM_INFO_TEXT])) return $this->_[HDOM_INFO_TEXT] = $value;
				return $this->_[HDOM_INFO_INNER] = $value;
		}
		if (!isset($this->attr[$name])) {
			$this->_[HDOM_INFO_SPACE][] = array(' ', '', '');
			$this->_[HDOM_INFO_QUOTE][] = HDOM_QUOTE_DOUBLE;
		}
		$this->attr[$name] = $value;
	}

	function __isset($name) {
		switch ($name) {
			case 'outertext': return true;
			case 'innertext': return true;
			case 'plaintext': return true;
		}
		//no value attr: nowrap, checked selected...
		return (array_key_exists($name, $this->attr)) ? true : isset($this->attr[$name]);
	}

	function __unset($name) {
		if (isset($this->attr[$name]))
			unset($this->attr[$name]);
	}

	// PaperG - Function to convert the text from one character set to another if the two sets are not the same.
	function convert_text($text)
	{
		global $debug_object;
		if (is_object($debug_object)) {$debug_object->debugLogEntry(1);}

		$converted_text = $text;

		$sourceCharset = "";
		$targetCharset = "";

		if ($this->dom)
		{
			$sourceCharset = strtoupper($this->dom->_charset);
			$targetCharset = strtoupper($this->dom->_target_charset);
		}
		if (is_object($debug_object)) {$debug_object->debugLog(3, "source charset: " . $sourceCharset . " target charaset: " . $targetCharset);}

		if (!empty($sourceCharset) && !empty($targetCharset) && (strcasecmp($sourceCharset, $targetCharset) != 0))
		{
			// Check if the reported encoding could have been incorrect and the text is actually already UTF-8
			if ((strcasecmp($targetCharset, 'UTF-8') == 0) && ($this->is_utf8($text)))
			{
				$converted_text = $text;
			}
			else
			{
				$converted_text = iconv($sourceCharset, $targetCharset, $text);
			}
		}

		// Lets make sure that we don't have that silly BOM issue with any of the utf-8 text we output.
		if ($targetCharset == 'UTF-8')
		{
			if (substr($converted_text, 0, 3) == "\xef\xbb\xbf")
			{
				$converted_text = substr($converted_text, 3);
			}
			if (substr($converted_text, -3) == "\xef\xbb\xbf")
			{
				$converted_text = substr($converted_text, 0, -3);
			}
		}

		return $converted_text;
	}

	/**
	* Returns true if $string is valid UTF-8 and false otherwise.
	*
	* @param mixed $str String to be tested
	* @return boolean
	*/
	static function is_utf8($str)
	{
		$c=0; $b=0;
		$bits=0;
		$len=strlen($str);
		for($i=0; $i<$len; $i++)
		{
			$c=ord($str[$i]);
			if($c > 128)
			{
				if(($c >= 254)) return false;
				elseif($c >= 252) $bits=6;
				elseif($c >= 248) $bits=5;
				elseif($c >= 240) $bits=4;
				elseif($c >= 224) $bits=3;
				elseif($c >= 192) $bits=2;
				else return false;
				if(($i+$bits) > $len) return false;
				while($bits > 1)
				{
					$i++;
					$b=ord($str[$i]);
					if($b < 128 || $b > 191) return false;
					$bits--;
				}
			}
		}
		return true;
	}
	/*
	function is_utf8($string)
	{
		//this is buggy
		return (utf8_encode(utf8_decode($string)) == $string);
	}
	*/

	/**
	 * Function to try a few tricks to determine the displayed size of an img on the page.
	 * NOTE: This will ONLY work on an IMG tag. Returns FALSE on all other tag types.
	 *
	 * @author John Schlick
	 * @version April 19 2012
	 * @return array an array containing the 'height' and 'width' of the image on the page or -1 if we can't figure it out.
	 */
	function get_display_size()
	{
		global $debug_object;

		$width = -1;
		$height = -1;

		if ($this->tag !== 'img')
		{
			return false;
		}

		// See if there is aheight or width attribute in the tag itself.
		if (isset($this->attr['width']))
		{
			$width = $this->attr['width'];
		}

		if (isset($this->attr['height']))
		{
			$height = $this->attr['height'];
		}

		// Now look for an inline style.
		if (isset($this->attr['style']))
		{
			// Thanks to user gnarf from stackoverflow for this regular expression.
			$attributes = array();
			preg_match_all("/([\w-]+)\s*:\s*([^;]+)\s*;?/", $this->attr['style'], $matches, PREG_SET_ORDER);
			foreach ($matches as $match) {
			  $attributes[$match[1]] = $match[2];
			}

			// If there is a width in the style attributes:
			if (isset($attributes['width']) && $width == -1)
			{
				// check that the last two characters are px (pixels)
				if (strtolower(substr($attributes['width'], -2)) == 'px')
				{
					$proposed_width = substr($attributes['width'], 0, -2);
					// Now make sure that it's an integer and not something stupid.
					if (filter_var($proposed_width, FILTER_VALIDATE_INT))
					{
						$width = $proposed_width;
					}
				}
			}

			// If there is a width in the style attributes:
			if (isset($attributes['height']) && $height == -1)
			{
				// check that the last two characters are px (pixels)
				if (strtolower(substr($attributes['height'], -2)) == 'px')
				{
					$proposed_height = substr($attributes['height'], 0, -2);
					// Now make sure that it's an integer and not something stupid.
					if (filter_var($proposed_height, FILTER_VALIDATE_INT))
					{
						$height = $proposed_height;
					}
				}
			}

		}

		// Future enhancement:
		// Look in the tag to see if there is a class or id specified that has a height or width attribute to it.

		// Far future enhancement
		// Look at all the parent tags of this image to see if they specify a class or id that has an img selector that specifies a height or width
		// Note that in this case, the class or id will have the img subselector for it to apply to the image.

		// ridiculously far future development
		// If the class or id is specified in a SEPARATE css file thats not on the page, go get it and do what we were just doing for the ones on the page.

		$result = array('height' => $height,
						'width' => $width);
		return $result;
	}

	// camel naming conventions
	function getAllAttributes() {return $this->attr;}
	function getAttribute($name) {return $this->__get($name);}
	function setAttribute($name, $value) {$this->__set($name, $value);}
	function hasAttribute($name) {return $this->__isset($name);}
	function removeAttribute($name) {$this->__set($name, null);}
	function getElementById($id) {return $this->find("#$id", 0);}
	function getElementsById($id, $idx=null) {return $this->find("#$id", $idx);}
	function getElementByTagName($name) {return $this->find($name, 0);}
	function getElementsByTagName($name, $idx=null) {return $this->find($name, $idx);}
	function parentNode() {return $this->parent();}
	function childNodes($idx=-1) {return $this->children($idx);}
	function firstChild() {return $this->first_child();}
	function lastChild() {return $this->last_child();}
	function nextSibling() {return $this->next_sibling();}
	function previousSibling() {return $this->prev_sibling();}
	function hasChildNodes() {return $this->has_child();}
	function nodeName() {return $this->tag;}
	function appendChild($node) {$node->parent($this); return $node;}

}

/**
 * simple html dom parser
 * Paperg - in the find routine: allow us to specify that we want case insensitive testing of the value of the selector.
 * Paperg - change $size from protected to public so we can easily access it
 * Paperg - added ForceTagsClosed in the constructor which tells us whether we trust the html or not.  Default is to NOT trust it.
 *
 * @package PlaceLocalInclude
 */
class simple_html_dom
{
	public $root = null;
	public $nodes = array();
	public $callback = null;
	public $lowercase = false;
	// Used to keep track of how large the text was when we started.
	public $original_size;
	public $size;
	protected $pos;
	protected $doc;
	protected $char;
	protected $cursor;
	protected $parent;
	protected $noise = array();
	protected $token_blank = " \t\r\n";
	protected $token_equal = ' =/>';
	protected $token_slash = " />\r\n\t";
	protected $token_attr = ' >';
	// Note that this is referenced by a child node, and so it needs to be public for that node to see this information.
	public $_charset = '';
	public $_target_charset = '';
	protected $default_br_text = "";
	public $default_span_text = "";

	// use isset instead of in_array, performance boost about 30%...
	protected $self_closing_tags = array('img'=>1, 'br'=>1, 'input'=>1, 'meta'=>1, 'link'=>1, 'hr'=>1, 'base'=>1, 'embed'=>1, 'spacer'=>1);
	protected $block_tags = array('root'=>1, 'body'=>1, 'form'=>1, 'div'=>1, 'span'=>1, 'table'=>1);
	// Known sourceforge issue #2977341
	// B tags that are not closed cause us to return everything to the end of the document.
	protected $optional_closing_tags = array(
		'tr'=>array('tr'=>1, 'td'=>1, 'th'=>1),
		'th'=>array('th'=>1),
		'td'=>array('td'=>1),
		'li'=>array('li'=>1),
		'dt'=>array('dt'=>1, 'dd'=>1),
		'dd'=>array('dd'=>1, 'dt'=>1),
		'dl'=>array('dd'=>1, 'dt'=>1),
		'p'=>array('p'=>1),
		'nobr'=>array('nobr'=>1),
		'b'=>array('b'=>1),
		'option'=>array('option'=>1),
	);

	function __construct($str=null, $lowercase=true, $forceTagsClosed=true, $target_charset=DEFAULT_TARGET_CHARSET, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT, $defaultSpanText=DEFAULT_SPAN_TEXT)
	{
		if ($str)
		{
			if (preg_match("/^http:\/\//i",$str) || is_file($str))
			{
				$this->load_file($str);
			}
			else
			{
				$this->load($str, $lowercase, $stripRN, $defaultBRText, $defaultSpanText);
			}
		}
		// Forcing tags to be closed implies that we don't trust the html, but it can lead to parsing errors if we SHOULD trust the html.
		if (!$forceTagsClosed) {
			$this->optional_closing_array=array();
		}
		$this->_target_charset = $target_charset;
	}

	function __destruct()
	{
		$this->clear();
	}

	// load html from string
	function load($str, $lowercase=true, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT, $defaultSpanText=DEFAULT_SPAN_TEXT)
	{
		global $debug_object;

		// prepare
		$this->prepare($str, $lowercase, $stripRN, $defaultBRText, $defaultSpanText);
		// strip out comments
		$this->remove_noise("'<!--(.*?)-->'is");
		// strip out cdata
		$this->remove_noise("'<!\[CDATA\[(.*?)\]\]>'is", true);
		// Per sourceforge http://sourceforge.net/tracker/?func=detail&aid=2949097&group_id=218559&atid=1044037
		// Script tags removal now preceeds style tag removal.
		// strip out <script> tags
		$this->remove_noise("'<\s*script[^>]*[^/]>(.*?)<\s*/\s*script\s*>'is");
		$this->remove_noise("'<\s*script\s*>(.*?)<\s*/\s*script\s*>'is");
		// strip out <style> tags
		$this->remove_noise("'<\s*style[^>]*[^/]>(.*?)<\s*/\s*style\s*>'is");
		$this->remove_noise("'<\s*style\s*>(.*?)<\s*/\s*style\s*>'is");
		// strip out preformatted tags
		$this->remove_noise("'<\s*(?:code)[^>]*>(.*?)<\s*/\s*(?:code)\s*>'is");
		// strip out server side scripts
		$this->remove_noise("'(<\?)(.*?)(\?>)'s", true);
		// strip smarty scripts
		$this->remove_noise("'(\{\w)(.*?)(\})'s", true);

		// parsing
		while ($this->parse());
		// end
		$this->root->_[HDOM_INFO_END] = $this->cursor;
		$this->parse_charset();

		// make load function chainable
		return $this;

	}

	// load html from file
	function load_file()
	{
		$args = func_get_args();
		$this->load(call_user_func_array('file_get_contents', $args), true);
		// Throw an error if we can't properly load the dom.
		if (($error=error_get_last())!==null) {
			$this->clear();
			return false;
		}
	}

	// set callback function
	function set_callback($function_name)
	{
		$this->callback = $function_name;
	}

	// remove callback function
	function remove_callback()
	{
		$this->callback = null;
	}

	// save dom as string
	function save($filepath='')
	{
		$ret = $this->root->innertext();
		if ($filepath!=='') file_put_contents($filepath, $ret, LOCK_EX);
		return $ret;
	}

	// find dom node by css selector
	// Paperg - allow us to specify that we want case insensitive testing of the value of the selector.
	function find($selector, $idx=null, $lowercase=false)
	{
		return $this->root->find($selector, $idx, $lowercase);
	}

	// clean up memory due to php5 circular references memory leak...
	function clear()
	{
		foreach ($this->nodes as $n) {$n->clear(); $n = null;}
		// This add next line is documented in the sourceforge repository. 2977248 as a fix for ongoing memory leaks that occur even with the use of clear.
		if (isset($this->children)) foreach ($this->children as $n) {$n->clear(); $n = null;}
		if (isset($this->parent)) {$this->parent->clear(); unset($this->parent);}
		if (isset($this->root)) {$this->root->clear(); unset($this->root);}
		unset($this->doc);
		unset($this->noise);
	}

	function dump($show_attr=true)
	{
		$this->root->dump($show_attr);
	}

	// prepare HTML data and init everything
	protected function prepare($str, $lowercase=true, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT, $defaultSpanText=DEFAULT_SPAN_TEXT)
	{
		$this->clear();

		// set the length of content before we do anything to it.
		$this->size = strlen($str);
		// Save the original size of the html that we got in.  It might be useful to someone.
		$this->original_size = $this->size;

		//before we save the string as the doc...  strip out the \r \n's if we are told to.
		if ($stripRN) {
			$str = str_replace("\r", " ", $str);
			$str = str_replace("\n", " ", $str);

			// set the length of content since we have changed it.
			$this->size = strlen($str);
		}

		$this->doc = $str;
		$this->pos = 0;
		$this->cursor = 1;
		$this->noise = array();
		$this->nodes = array();
		$this->lowercase = $lowercase;
		$this->default_br_text = $defaultBRText;
		$this->default_span_text = $defaultSpanText;
		$this->root = new simple_html_dom_node($this);
		$this->root->tag = 'root';
		$this->root->_[HDOM_INFO_BEGIN] = -1;
		$this->root->nodetype = HDOM_TYPE_ROOT;
		$this->parent = $this->root;
		if ($this->size>0) $this->char = $this->doc[0];
	}

	// parse html content
	protected function parse()
	{
		if (($s = $this->copy_until_char('<'))==='')
		{
			return $this->read_tag();
		}

		// text
		$node = new simple_html_dom_node($this);
		++$this->cursor;
		$node->_[HDOM_INFO_TEXT] = $s;
		$this->link_nodes($node, false);
		return true;
	}

	// PAPERG - dkchou - added this to try to identify the character set of the page we have just parsed so we know better how to spit it out later.
	// NOTE:  IF you provide a routine called get_last_retrieve_url_contents_content_type which returns the CURLINFO_CONTENT_TYPE from the last curl_exec
	// (or the content_type header from the last transfer), we will parse THAT, and if a charset is specified, we will use it over any other mechanism.
	protected function parse_charset()
	{
		global $debug_object;

		$charset = null;

		if (function_exists('get_last_retrieve_url_contents_content_type'))
		{
			$contentTypeHeader = get_last_retrieve_url_contents_content_type();
			$success = preg_match('/charset=(.+)/', $contentTypeHeader, $matches);
			if ($success)
			{
				$charset = $matches[1];
				if (is_object($debug_object)) {$debug_object->debugLog(2, 'header content-type found charset of: ' . $charset);}
			}

		}

		if (empty($charset))
		{
			$el = $this->root->find('meta[http-equiv=Content-Type]',0);
			if (!empty($el))
			{
				$fullvalue = $el->content;
				if (is_object($debug_object)) {$debug_object->debugLog(2, 'meta content-type tag found' . $fullvalue);}

				if (!empty($fullvalue))
				{
					$success = preg_match('/charset=(.+)/', $fullvalue, $matches);
					if ($success)
					{
						$charset = $matches[1];
					}
					else
					{
						// If there is a meta tag, and they don't specify the character set, research says that it's typically ISO-8859-1
						if (is_object($debug_object)) {$debug_object->debugLog(2, 'meta content-type tag couldn\'t be parsed. using iso-8859 default.');}
						$charset = 'ISO-8859-1';
					}
				}
			}
		}

		// If we couldn't find a charset above, then lets try to detect one based on the text we got...
		if (empty($charset))
		{
			// Have php try to detect the encoding from the text given to us.
			$charset = mb_detect_encoding($this->root->plaintext . "ascii", $encoding_list = array( "UTF-8", "CP1252" ) );
			if (is_object($debug_object)) {$debug_object->debugLog(2, 'mb_detect found: ' . $charset);}

			// and if this doesn't work...  then we need to just wrongheadedly assume it's UTF-8 so that we can move on - cause this will usually give us most of what we need...
			if ($charset === false)
			{
				if (is_object($debug_object)) {$debug_object->debugLog(2, 'since mb_detect failed - using default of utf-8');}
				$charset = 'UTF-8';
			}
		}

		// Since CP1252 is a superset, if we get one of it's subsets, we want it instead.
		if ((strtolower($charset) == strtolower('ISO-8859-1')) || (strtolower($charset) == strtolower('Latin1')) || (strtolower($charset) == strtolower('Latin-1')))
		{
			if (is_object($debug_object)) {$debug_object->debugLog(2, 'replacing ' . $charset . ' with CP1252 as its a superset');}
			$charset = 'CP1252';
		}

		if (is_object($debug_object)) {$debug_object->debugLog(1, 'EXIT - ' . $charset);}

		return $this->_charset = $charset;
	}

	// read tag info
	protected function read_tag()
	{
		if ($this->char!=='<')
		{
			$this->root->_[HDOM_INFO_END] = $this->cursor;
			return false;
		}
		$begin_tag_pos = $this->pos;
		$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next

		// end tag
		if ($this->char==='/')
		{
			$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
			// This represents the change in the simple_html_dom trunk from revision 180 to 181.
			// $this->skip($this->token_blank_t);
			$this->skip($this->token_blank);
			$tag = $this->copy_until_char('>');

			// skip attributes in end tag
			if (($pos = strpos($tag, ' '))!==false)
				$tag = substr($tag, 0, $pos);

			$parent_lower = strtolower($this->parent->tag);
			$tag_lower = strtolower($tag);

			if ($parent_lower!==$tag_lower)
			{
				if (isset($this->optional_closing_tags[$parent_lower]) && isset($this->block_tags[$tag_lower]))
				{
					$this->parent->_[HDOM_INFO_END] = 0;
					$org_parent = $this->parent;

					while (($this->parent->parent) && strtolower($this->parent->tag)!==$tag_lower)
						$this->parent = $this->parent->parent;

					if (strtolower($this->parent->tag)!==$tag_lower) {
						$this->parent = $org_parent; // restore origonal parent
						if ($this->parent->parent) $this->parent = $this->parent->parent;
						$this->parent->_[HDOM_INFO_END] = $this->cursor;
						return $this->as_text_node($tag);
					}
				}
				else if (($this->parent->parent) && isset($this->block_tags[$tag_lower]))
				{
					$this->parent->_[HDOM_INFO_END] = 0;
					$org_parent = $this->parent;

					while (($this->parent->parent) && strtolower($this->parent->tag)!==$tag_lower)
						$this->parent = $this->parent->parent;

					if (strtolower($this->parent->tag)!==$tag_lower)
					{
						$this->parent = $org_parent; // restore origonal parent
						$this->parent->_[HDOM_INFO_END] = $this->cursor;
						return $this->as_text_node($tag);
					}
				}
				else if (($this->parent->parent) && strtolower($this->parent->parent->tag)===$tag_lower)
				{
					$this->parent->_[HDOM_INFO_END] = 0;
					$this->parent = $this->parent->parent;
				}
				else
					return $this->as_text_node($tag);
			}

			$this->parent->_[HDOM_INFO_END] = $this->cursor;
			if ($this->parent->parent) $this->parent = $this->parent->parent;

			$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
			return true;
		}

		$node = new simple_html_dom_node($this);
		$node->_[HDOM_INFO_BEGIN] = $this->cursor;
		++$this->cursor;
		$tag = $this->copy_until($this->token_slash);
		$node->tag_start = $begin_tag_pos;

		// doctype, cdata & comments...
		if (isset($tag[0]) && $tag[0]==='!') {
			$node->_[HDOM_INFO_TEXT] = '<' . $tag . $this->copy_until_char('>');

			if (isset($tag[2]) && $tag[1]==='-' && $tag[2]==='-') {
				$node->nodetype = HDOM_TYPE_COMMENT;
				$node->tag = 'comment';
			} else {
				$node->nodetype = HDOM_TYPE_UNKNOWN;
				$node->tag = 'unknown';
			}
			if ($this->char==='>') $node->_[HDOM_INFO_TEXT].='>';
			$this->link_nodes($node, true);
			$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
			return true;
		}

		// text
		if ($pos=strpos($tag, '<')!==false) {
			$tag = '<' . substr($tag, 0, -1);
			$node->_[HDOM_INFO_TEXT] = $tag;
			$this->link_nodes($node, false);
			$this->char = $this->doc[--$this->pos]; // prev
			return true;
		}

		if (!preg_match("/^[\w-:]+$/", $tag)) {
			$node->_[HDOM_INFO_TEXT] = '<' . $tag . $this->copy_until('<>');
			if ($this->char==='<') {
				$this->link_nodes($node, false);
				return true;
			}

			if ($this->char==='>') $node->_[HDOM_INFO_TEXT].='>';
			$this->link_nodes($node, false);
			$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
			return true;
		}

		// begin tag
		$node->nodetype = HDOM_TYPE_ELEMENT;
		$tag_lower = strtolower($tag);
		$node->tag = ($this->lowercase) ? $tag_lower : $tag;

		// handle optional closing tags
		if (isset($this->optional_closing_tags[$tag_lower]) )
		{
			while (isset($this->optional_closing_tags[$tag_lower][strtolower($this->parent->tag)]))
			{
				$this->parent->_[HDOM_INFO_END] = 0;
				$this->parent = $this->parent->parent;
			}
			$node->parent = $this->parent;
		}

		$guard = 0; // prevent infinity loop
		$space = array($this->copy_skip($this->token_blank), '', '');

		// attributes
		do
		{
			if ($this->char!==null && $space[0]==='')
			{
				break;
			}
			$name = $this->copy_until($this->token_equal);
			if ($guard===$this->pos)
			{
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				continue;
			}
			$guard = $this->pos;

			// handle endless '<'
			if ($this->pos>=$this->size-1 && $this->char!=='>') {
				$node->nodetype = HDOM_TYPE_TEXT;
				$node->_[HDOM_INFO_END] = 0;
				$node->_[HDOM_INFO_TEXT] = '<'.$tag . $space[0] . $name;
				$node->tag = 'text';
				$this->link_nodes($node, false);
				return true;
			}

			// handle mismatch '<'
			if ($this->doc[$this->pos-1]=='<') {
				$node->nodetype = HDOM_TYPE_TEXT;
				$node->tag = 'text';
				$node->attr = array();
				$node->_[HDOM_INFO_END] = 0;
				$node->_[HDOM_INFO_TEXT] = substr($this->doc, $begin_tag_pos, $this->pos-$begin_tag_pos-1);
				$this->pos -= 2;
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				$this->link_nodes($node, false);
				return true;
			}

			if ($name!=='/' && $name!=='') {
				$space[1] = $this->copy_skip($this->token_blank);
				$name = $this->restore_noise($name);
				if ($this->lowercase) $name = strtolower($name);
				if ($this->char==='=') {
					$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
					$this->parse_attr($node, $name, $space);
				}
				else {
					//no value attr: nowrap, checked selected...
					$node->_[HDOM_INFO_QUOTE][] = HDOM_QUOTE_NO;
					$node->attr[$name] = true;
					if ($this->char!='>') $this->char = $this->doc[--$this->pos]; // prev
				}
				$node->_[HDOM_INFO_SPACE][] = $space;
				$space = array($this->copy_skip($this->token_blank), '', '');
			}
			else
				break;
		} while ($this->char!=='>' && $this->char!=='/');

		$this->link_nodes($node, true);
		$node->_[HDOM_INFO_ENDSPACE] = $space[0];

		// check self closing
		if ($this->copy_until_char_escape('>')==='/')
		{
			$node->_[HDOM_INFO_ENDSPACE] .= '/';
			$node->_[HDOM_INFO_END] = 0;
		}
		else
		{
			// reset parent
			if (!isset($this->self_closing_tags[strtolower($node->tag)])) $this->parent = $node;
		}
		$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next

		// If it's a BR tag, we need to set it's text to the default text.
		// This way when we see it in plaintext, we can generate formatting that the user wants.
		// since a br tag never has sub nodes, this works well.
		if ($node->tag == "br")
		{
			$node->_[HDOM_INFO_INNER] = $this->default_br_text;
		}

		return true;
	}

	// parse attributes
	protected function parse_attr($node, $name, &$space)
	{
		// Per sourceforge: http://sourceforge.net/tracker/?func=detail&aid=3061408&group_id=218559&atid=1044037
		// If the attribute is already defined inside a tag, only pay atetntion to the first one as opposed to the last one.
		if (isset($node->attr[$name]))
		{
			return;
		}

		$space[2] = $this->copy_skip($this->token_blank);
		switch ($this->char) {
			case '"':
				$node->_[HDOM_INFO_QUOTE][] = HDOM_QUOTE_DOUBLE;
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				$node->attr[$name] = $this->restore_noise($this->copy_until_char_escape('"'));
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				break;
			case '\'':
				$node->_[HDOM_INFO_QUOTE][] = HDOM_QUOTE_SINGLE;
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				$node->attr[$name] = $this->restore_noise($this->copy_until_char_escape('\''));
				$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
				break;
			default:
				$node->_[HDOM_INFO_QUOTE][] = HDOM_QUOTE_NO;
				$node->attr[$name] = $this->restore_noise($this->copy_until($this->token_attr));
		}
		// PaperG: Attributes should not have \r or \n in them, that counts as html whitespace.
		$node->attr[$name] = str_replace("\r", "", $node->attr[$name]);
		$node->attr[$name] = str_replace("\n", "", $node->attr[$name]);
		// PaperG: If this is a "class" selector, lets get rid of the preceeding and trailing space since some people leave it in the multi class case.
		if ($name == "class") {
			$node->attr[$name] = trim($node->attr[$name]);
		}
	}

	// link node's parent
	protected function link_nodes(&$node, $is_child)
	{
		$node->parent = $this->parent;
		$this->parent->nodes[] = $node;
		if ($is_child)
		{
			$this->parent->children[] = $node;
		}
	}

	// as a text node
	protected function as_text_node($tag)
	{
		$node = new simple_html_dom_node($this);
		++$this->cursor;
		$node->_[HDOM_INFO_TEXT] = '</' . $tag . '>';
		$this->link_nodes($node, false);
		$this->char = (++$this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
		return true;
	}

	protected function skip($chars)
	{
		$this->pos += strspn($this->doc, $chars, $this->pos);
		$this->char = ($this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
	}

	protected function copy_skip($chars)
	{
		$pos = $this->pos;
		$len = strspn($this->doc, $chars, $pos);
		$this->pos += $len;
		$this->char = ($this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
		if ($len===0) return '';
		return substr($this->doc, $pos, $len);
	}

	protected function copy_until($chars)
	{
		$pos = $this->pos;
		$len = strcspn($this->doc, $chars, $pos);
		$this->pos += $len;
		$this->char = ($this->pos<$this->size) ? $this->doc[$this->pos] : null; // next
		return substr($this->doc, $pos, $len);
	}

	protected function copy_until_char($char)
	{
		if ($this->char===null) return '';

		if (($pos = strpos($this->doc, $char, $this->pos))===false) {
			$ret = substr($this->doc, $this->pos, $this->size-$this->pos);
			$this->char = null;
			$this->pos = $this->size;
			return $ret;
		}

		if ($pos===$this->pos) return '';
		$pos_old = $this->pos;
		$this->char = $this->doc[$pos];
		$this->pos = $pos;
		return substr($this->doc, $pos_old, $pos-$pos_old);
	}

	protected function copy_until_char_escape($char)
	{
		if ($this->char===null) return '';

		$start = $this->pos;
		while (1)
		{
			if (($pos = strpos($this->doc, $char, $start))===false)
			{
				$ret = substr($this->doc, $this->pos, $this->size-$this->pos);
				$this->char = null;
				$this->pos = $this->size;
				return $ret;
			}

			if ($pos===$this->pos) return '';

			if ($this->doc[$pos-1]==='\\') {
				$start = $pos+1;
				continue;
			}

			$pos_old = $this->pos;
			$this->char = $this->doc[$pos];
			$this->pos = $pos;
			return substr($this->doc, $pos_old, $pos-$pos_old);
		}
	}

	// remove noise from html content
	// save the noise in the $this->noise array.
	protected function remove_noise($pattern, $remove_tag=false)
	{
		global $debug_object;
		if (is_object($debug_object)) { $debug_object->debugLogEntry(1); }

		$count = preg_match_all($pattern, $this->doc, $matches, PREG_SET_ORDER|PREG_OFFSET_CAPTURE);

		for ($i=$count-1; $i>-1; --$i)
		{
			$key = '___noise___'.sprintf('% 5d', count($this->noise)+1000);
			if (is_object($debug_object)) { $debug_object->debugLog(2, 'key is: ' . $key); }
			$idx = ($remove_tag) ? 0 : 1;
			$this->noise[$key] = $matches[$i][$idx][0];
			$this->doc = substr_replace($this->doc, $key, $matches[$i][$idx][1], strlen($matches[$i][$idx][0]));
		}

		// reset the length of content
		$this->size = strlen($this->doc);
		if ($this->size>0)
		{
			$this->char = $this->doc[0];
		}
	}

	// restore noise to html content
	function restore_noise($text)
	{
		global $debug_object;
		if (is_object($debug_object)) { $debug_object->debugLogEntry(1); }

		while (($pos=strpos($text, '___noise___'))!==false)
		{
			// Sometimes there is a broken piece of markup, and we don't GET the pos+11 etc... token which indicates a problem outside of us...
			if (strlen($text) > $pos+15)
			{
				$key = '___noise___'.$text[$pos+11].$text[$pos+12].$text[$pos+13].$text[$pos+14].$text[$pos+15];
				if (is_object($debug_object)) { $debug_object->debugLog(2, 'located key of: ' . $key); }

				if (isset($this->noise[$key]))
				{
					$text = substr($text, 0, $pos).$this->noise[$key].substr($text, $pos+16);
				}
				else
				{
					// do this to prevent an infinite loop.
					$text = substr($text, 0, $pos).'UNDEFINED NOISE FOR KEY: '.$key . substr($text, $pos+16);
				}
			}
			else
			{
				// There is no valid key being given back to us... We must get rid of the ___noise___ or we will have a problem.
				$text = substr($text, 0, $pos).'NO NUMERIC NOISE KEY' . substr($text, $pos+11);
			}
		}
		return $text;
	}

	// Sometimes we NEED one of the noise elements.
	function search_noise($text)
	{
		global $debug_object;
		if (is_object($debug_object)) { $debug_object->debugLogEntry(1); }

		foreach($this->noise as $noiseElement)
		{
			if (strpos($noiseElement, $text)!==false)
			{
				return $noiseElement;
			}
		}
	}
	function __toString()
	{
		return $this->root->innertext();
	}

	function __get($name)
	{
		switch ($name)
		{
			case 'outertext':
				return $this->root->innertext();
			case 'innertext':
				return $this->root->innertext();
			case 'plaintext':
				return $this->root->text();
			case 'charset':
				return $this->_charset;
			case 'target_charset':
				return $this->_target_charset;
		}
	}

	// camel naming conventions
	function childNodes($idx=-1) {return $this->root->childNodes($idx);}
	function firstChild() {return $this->root->first_child();}
	function lastChild() {return $this->root->last_child();}
	function createElement($name, $value=null) {return @str_get_html("<$name>$value</$name>")->first_child();}
	function createTextNode($value) {return @end(str_get_html($value)->nodes);}
	function getElementById($id) {return $this->find("#$id", 0);}
	function getElementsById($id, $idx=null) {return $this->find("#$id", $idx);}
	function getElementByTagName($name) {return $this->find($name, 0);}
	function getElementsByTagName($name, $idx=-1) {return $this->find($name, $idx);}
	function loadFile() {$args = func_get_args();$this->load_file($args);}
}

?>




























<?php
/*
this thing uses composer
curl -sS https://getcomposer.org/installer | php
and goute
php composer.phar require fabpot/goutte:~2.0
and bower
*/
session_start();
mb_internal_encoding('UTF-8');
mb_http_output('UTF-8');

require 'vendor/autoload.php';


function setArgs(){
	foreach ( $_POST as $key=>$value ) {
	    if ( !empty($value) ) {
	        $_SESSION['args'][$key] = $value;
	    }
	}
	foreach ($_GET as $key=>$value) {
		if ( !empty($value) ) {
	        $_SESSION['args'][$key] = $value;
	    }
	}	
}

function getArg($arg) {
	return isset($_SESSION['args'][$arg]) ? $_SESSION['args'][$arg] : getDefaults($arg) ;
}

function getDefaults($arg) {
	$DEFAULTS=array();
	if (file_exists('defaults.php')) {
		include('defaults.php');
	}
	return ($DEFAULTS[$arg] ? $DEFAULTS[$arg] : '');
}



function getResults() {
    $results=array();

	$goutte = new Goutte\Client();
    $baseURL = 'http://www.leboncoin.fr/';

    $locations = split(',',getArg('location'));

    $adtype = getArg('adtype')!='' ? getArg('adtype') : 'locations';

    foreach($locations as $location) {
    	$location=trim($location);
	
	    $urlEndpoint = $adtype.'/offres/?f=a&th=1'
	    				.(getArg('q')!=''? '&q='.getArg('q') : '')
	    				.'&mrs='.getArg('mrs')
	    				.'&mre='.getArg('mre')
	    				.'&location='.$location 
	    				. (getArg('f')!='' ? '&f='.getArg('f') : '');

	    $selector = '.list-lbc';

	    $crawler = $goutte->request('GET', $baseURL . $urlEndpoint);

	    $results[$location] = $crawler->filter($selector)->each(function ($node, $i) {
	        return $node;	// This is a DOMElement Object
	    });
    }
	return $results;

}

function printResults($results) {
	foreach($results as $key=>$nodes) {
		echo '<div class="panel  panel-default" id="panel-'.$key.'">';
		echo '<div class="panel-heading">
				<h4><span class="postal-code">'.$key.'</span>
					<span class="city"></span>
				</h4>
				</div>';
		echo '<div class="panel-body">';
		foreach($nodes as $node) {
			echo $node->html();
		}
		echo '</div>';
		echo '</div>';
	}
}


?>






















































<form name="searchform" role="form" method="post">
  <div class="row">

    <div class="col-md-5 form-group">
      <label for="q" class="col-md-3 control-label">Query</label>
      <div class="col-md-9">
        <input type="text" class="form-control" id="q" name="q" placeholder="Mots pour la recherche" value="<?php echo getArg('q'); ?>">
      </div>
    </div>

    <div class="location col-md-7 form-group">
      <label for="location" class="col-md-3 control-label">Code Postal
      </label>
      <div class="col-md-7">
        <input type="text" class="form-control" id="location" name="location" placeholder="Cï¿½digos postales separados por coma" value="<?php echo getArg('location'); ?>">
      </div>
      <a class="explanation" target="_blank" href="http://www.freemaptools.com/find-french-postcodes-inside-radius.htm">Carte 1</a>
      <a class="explanation" target="_blank" href="http://atlas.cosmosia.com/">Carte 2</a>
    </div>
  </div>
  <div class="row">
    <input type="hidden" id="adtype" name="adtype" value="announces">
    <button type="submit" class="btn btn-success pull-right">Chercher</button>
  </div>
</form>









































































VUE INDEX.PHTML


<?php
$_SESSION ["obj_log"]->logg ( 1, 0, "EMERG", "ALERT", "CRIT", "ERR", "WARN", "NOTICE", "INFO-vue", "DEBUG", APPLICATION_PATH . "/" . basename ( __DIR__ ), basename ( __FILE__ ), basename ( __FUNCTION__ ), basename ( __LINE__ ), recupere_php_backtrace () );
?>
<!doctype html>
<html>
<head>
<title><?php echo strtoupper ( PROJET_NOM )." - ACCUEIL" ?></title>
</head>
<body>
	<div id="conteneur">
		<div id="zone_haut">
			<p><?php echo PROJET_NOM ?></p>
		</div>
		<div id="zone_menu">
			<h2>menu1 - menu2</h2>
		</div>
		<div id="zone_milieu">
			<p id="titre">Release</p>
			<ul>
				<li><a
					href="http://127.0.0.1/projects/KOINKOIN/public/index/releases">Release
						0.01</a></li>
			</ul>
			<h3>Filtres</h3>
			<ul>
				<li><a
					href="http://127.0.0.1/projects/KOINKOIN/public/filtre?methode=uneUrlunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">Filtre
						: 1 url + 1 filtre Xpath</a></li>
			</ul>
		</div>
	</div>
</body>
</html>

































<body>
	<div id="zone_haut">
		<h1><?php PROJET_NOM ?></h1>
	</div>
	<!-- fin zone_haut -->
	<div id=zone_milieu>
		<h2>Release</h2>
		<ul>
			<li><a
				href="http://127.0.0.1/projects/KOINKOIN/public/index/releases">Release
					0.01</a></li>
		</ul>
		<h2>Filtres</h2>
		<ul>
			<li><a
				href="http://127.0.0.1/projects/KOINKOIN/public/filtre?methode=uneUrlunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">Filtre
					: 1 url + 1 filtre Xpath</a></li>
		</ul>
	</div>
	<!-- fin zone_milieu -->
</body>



		// ob_start ();
		// var_dump ( $_SERVER );
		// $php_backtrace = ob_get_clean ();
		// $this->log->setEventItem ( 'php_backtrace', $php_backtrace );
		
		// die ();
		// ob_start();
		// d($_SERVER);
		// $my_dump_dd = ob_get_clean();
		// $this -> log -> setEventItem('my_dump_dd', $my_dump_dd);
		
		// $ligne_en_cours = basename ( __LINE__ );
		// $this->log->setEventItem ( 'ligne_en_cours', $ligne_en_cours );













 ( basename ( __DIR__ ), basename ( __FILE__ ) ) )
$obj_log->log->setEventItem ( 'fonction_en_cours', basename ( __FUNCTION__ ) );
$obj_log->log->setEventItem ( 'ligne_en_cours', basename ( __LINE__ ) );



		// $my_num_transaction = md5(time().rand()).substr(str_shuffle(str_repeat('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',500)),10,50000000);
		// $this -> log -> setEventItem('my_num_transaction', $my_num_transaction);
		
		// $path_fichier_en_cours = basename(__DIR__);
		// $nom_fichier_en_cours = basename(__FILE__);
		// $my_path_fichier_en_cours = $path_fichier_en_cours.'/'.$nom_fichier_en_cours;
		// $this -> log -> setEventItem('my_path_fichier_en_cours', $my_path_fichier_en_cours);
		
		// ob_start();
		// var_dump(debug_backtrace());
		// $my_php_debug_backtrace = ob_get_clean();
		// $this -> log -> setEventItem('my_php_debug_backtrace', $my_php_debug_backtrace);
		
		// $my_fonction_en_cours = basename(__FUNCTION__);
		// $this -> log -> setEventItem('my_fonction_en_cours', $my_fonction_en_cours);
		





// 'log_num_transaction' => 'my_num_transaction',
// 'log_path_fichier_en_cours' => 'my_path_fichier_en_cours',
// 'log_php_debug_backtrace' => 'my_php_debug_backtrace',
	public function init()
    {
		$this -> obj_my_fonctions = new my_fonctions();
    
		$this -> obj_log = new my_fonctions_log();
		$this -> obj_log -> log -> setEventItem('my_path_fichier_en_cours', $this -> obj_my_fonctions -> file_get_path_fichier_origine(basename(__DIR__),basename(__FILE__)));
		$this -> obj_log -> log -> setEventItem('my_num_transaction', $this -> obj_my_fonctions -> str_retourne_hash_alphanumerique());
		$this -> obj_log -> log -> setEventItem('my_php_debug_backtrace', $this -> obj_my_fonctions -> debug_get_php_backtrace());
		$this -> obj_log -> log -> setEventItem('my_fonction_en_cours', basename(__FUNCTION__));
		$this -> obj_log -> log -> setEventItem('my_log_num_ligne', basename(__LINE__));
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::EMERG); // EMERG = 0 = urgence systï¿½me inutilisable = ARRET IMMEDIAT
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::ALERT); // ALERT = 1 = mesure corrective attendue immï¿½diatement
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::CRIT); // CRIT = 2 = critique = mesure corrective attendue
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::ERR); // ERR = 3 = erreur signalï¿½es
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::WARN); // WARN = 4 = avertissements signalï¿½s
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::NOTICE); // NOTICE = 5 = normal mais ï¿½tat significatif
		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::INFO);// INFO = 6 = message normal (utilisateur)
// 		$this -> obj_log -> log -> log("Initialisation du controlleur index : reussite", Zend_Log::DEBUG); // DEBUG = 7 = messages techniques de debogage
		
		


// 'log_fonction_en_cours' => 'my_fonction_en_cours',
// 'log_dump_dd' => 'my_dump_dd',
// 'log_php_server_trace' => 'my_log_php_server_trace',
// 'log_num_ligne' => 'my_log_num_ligne')



// $obj_log -> file_get_path_fichier_origine(basename(__DIR__),basename(__FILE__));





exit;

$path_fichier_en_cours = basename(__DIR__);
$nom_fichier_en_cours = basename(__FILE__);
$my_path_fichier_en_cours = $path_fichier_en_cours.'/'.$nom_fichier_en_cours;
$obj_log -> log -> setEventItem('my_path_fichier_en_cours', $my_path_fichier_en_cours);
$obj_log -> log -> log("Initialisation du log : reussite", Zend_Log::INFO);

// $obj_log -> log( 'INFO', 'Initialisation du log : reussite', $log_redacteur_vars);





























// 		throw new Exception("COQUILLE VIDE ?   --->>  ".$fichier_origine);

		// 		$path_fichier_en_cours = basename(__DIR__);
// 		$nom_fichier_en_cours = basename(__FILE__);
// 		$this -> log -> setEventItem('my_path_fichier_en_cours', $my_path_fichier_en_cours);




// 		$path_fichier_en_cours = basename(__DIR__);
// 		$nom_fichier_en_cours = basename(__FILE__);
// 		$my_path_fichier_en_cours = $path_fichier_en_cours.'/'.$nom_fichier_en_cours;
// 		$this -> log -> setEventItem('my_path_fichier_en_cours', $my_path_fichier_en_cours);








	public function log_init()
	{
		$parametres_bdd = array
		(
			'host'		=> LOGS_BDD_HOTE,
			'username'	=> LOGS_BDD_UTILISATEUR,
			'password'	=> LOGS_BDD_MOT_DE_PASSE,
			'dbname'	=> LOGS_BDD_NOM
		);
		
		$obj_bdd = Zend_Db::factory('PDO_MYSQL', $parametres_bdd);
		
		$redacteur = new Zend_Log_Writer_Db($obj_bdd, LOGS_TABLE_NOM, array
		(
			'log_num_niveau_priorite' => 'priority',
			'log_nom_niveau_priorite' => 'priorityName',
			'log_txt_message' => 'message',
			'log_num_transaction' => 'num_transaction',
			'log_timemestamp' => 'timestamp')
		);
		
		$obj_log = new Zend_Log($log_redacteur);
		$log_num_transaction = md5(time().rand()).substr(str_shuffle(str_repeat('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',50)),0,5000);
		$obj_log->setEventItem('num_transaction', $log_num_transaction);
		$obj_log->log("test1", Zend_Log::INFO);
		$obj_log->setEventItem('num_transaction', $log_num_transaction);
	}
















//	throw new Exception("COQUILLE VIDE !");
	
	// EMERG   = 0;  // Urgence : le systï¿½me est inutilisable
	// ALERT   = 1;  // Alerte: une mesure corrective
	//                   // doit ï¿½tre prise immï¿½diatement
	// CRIT    = 2;  // Critique : ï¿½tats critiques
	// ERR     = 3;  // Erreur: ï¿½tats d'erreur
	// WARN    = 4;  // Avertissement: ï¿½tats d'avertissement
	// NOTICE  = 5;  // Notice: normal mais ï¿½tat significatif
	// INFO    = 6;  // Information: messages d'informations
	// DEBUG   = 7;  // Debug: messages de dï¿½boguages
	
	$logger->log("Message d'information", Zend_Log::INFO);
	
	$log_obj->log("Message d'information", Zend_Log::INFO);
	$log_obj->log("Message d'information", Zend_Log::INFO);
	
	$log_obj->info("Message d'information");
	$log_obj->emerg("Message systeme urgence immediate");
	$log_obj->err("Message d'erreur");
	$log_obj->info("Message d'information");
	
	
	






substr(str_shuffle(str_repeat('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',5)),0,5);
substr(str_shuffle(str_repeat('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',50)),0,5000000);






$planDeCorrespondance = array('log_niveau' => 'priority', 'log_message' => 'message');
$redacteur = new Zend_Log_Writer_Db($db, LOGS_TABLE_NOM, $planDeCorrespondance);
parametres = array
(
	'host'		=> LOGS_BDD_HOTE,
	'username'	=> LOGS_BDD_UTILISATEUR,
	'password'	=> LOGS_BDD_MOT_DE_PASSE,
	'dbname'	=> LOGS_BDD_NOM
);

$db = Zend_Db::factory('PDO_MYSQL', $parametres);





$log_writer = new Zend_Log_Writer_Db($db, LOGS_TABLE_NOM,
		array(
				'log_num_niveau_priorite' => 'priority',
				'log_nom_niveau_priorite' => 'priorityName',
				'log_txt_message' => 'message',
				'log_ip_visiteur' => 'ip_visiteur',
				'log_timemestamp' => 'timestamp'
		)
		);




		$_SESSION ['koinkoin'] ['configuration_utilisateur'] ['projet_sgbd_mot_de_passe'] = 'titine';
		$_SESSION ['koinkoin'] ['configuration_utilisateur'] ['projet_sgbd_serveur_hote_nom'] = 'miloute';
		$_SESSION ['koinkoin'] ['configuration_utilisateur'] ['projet_sgbd_login_utilisateur'] = 'titine';
		$_SESSION ['koinkoin'] ['configuration_utilisateur'] ['projet_sgbd_bdd_nom'] = 'titine';


// $log_obj = new Zend_Log($redacteur);
$log_obj = new Zend_Log($log_writer);
$log_obj->log("Message d'information", Zend_Log::INFO);



























/*
    _  __ ____  _____  _   _  _  _  ____  _____  _   _
   | |/ // __ \|_   _|| \ | || |/ // __ \|_   _|| \ | |
   | ' /| |  | | | |  |  \| || ' /| |  | | | |  |  \| |
   |  < | |  | | | |  | . ` ||  < | |  | | | |  | . ` |
   | . \| |__| |_| |_ | |\  || . \| |__| |_| |_ | |\  |
   |_|\_\\____/|_____||_| \_||_|\_\\____/|_____||_| \_|   
   libre, gratuit & opensource           version 0.0.01
   
   mail     : koinkoin@dreamproject.fr  
   doc      : http;//dreamproject.fr/koinkoin/
   synopsis : koinkoin est un ensemble zend + mysql qui vous permet de d'automatiser la rï¿½cupï¿½reration de contenus de vos pages web
 
 */

//**************************************************
// Zend
//**************************************************
defined('APPLICATION_PATH') || define('APPLICATION_PATH', realpath(dirname(__FILE__).'/../application'));
defined('APPLICATION_ENV') || define ('APPLICATION_ENV', (getenv('APPLICATION_ENV') ? getenv('APPLICATION_ENV') : 'devellopement'));




















/*  _  __ ____  _____  _   _  _  _  ____  _____  _   _
   | |/ // __ \|_   _|| \ | || |/ // __ \|_   _|| \ | |
   | ' /| |  | | | |  |  \| || ' /| |  | | | |  |  \| |
   |  < | |  | | | |  | . ` ||  < | |  | | | |  | . ` |
   | . \| |__| |_| |_ | |\  || . \| |__| |_| |_ | |\  |
   |_|\_\\____/|_____||_| \_||_|\_\\____/|_____||_| \_|   
   
   version       : 0.0.01
   licence       : libre, gratuit & opensource 
   mail          : koinkoin@dreamproject.fr
   documentation : http;//dreamproject.fr/koinkoin/
   
   synopsis      : koinkoin est un ensemble de classe + zend + mysql
                   qui vous permet de d'automatiser la rï¿½cupï¿½reration de contenus
                   de vos pages web */

//**************************************************
// Zend
//**************************************************
defined('APPLICATION_PATH') || define('APPLICATION_PATH', realpath(dirname(__FILE__).'/../application'));
defined('APPLICATION_ENV') || define ('APPLICATION_ENV', (getenv('APPLICATION_ENV') ? getenv('APPLICATION_ENV') : 'production'));












[production]
phpSettings.display_startup_errors = 1
phpSettings.display_errors = 1
resources.frontController.params.displayExceptions = 1
phpSettings.date.timezone = "Europe/Paris"
appnamespace = "koinkoin"
includePaths.library = APPLICATION_PATH "/../library"
resources.frontController.controllerDirectory = APPLICATION_PATH "/controllers"
bootstrap.path = APPLICATION_PATH "/Bootstrap.php"
bootstrap.class = "Bootstrap"
/










/**************************************************
// Logs
//**************************************************
// $obj_logs = $log_obj = new Zend_Log();
// // $redacteur = new Zend_Log_Writer_Stream('php://output');
// $obj_logs->addWriter($redacteur);
// $obj_logs->log(PROJET_NOM, Zend_Log::INFO);






$parametres = array
(
	'host'		=> '127.0.0.1',
	'username'	=> 'root',
	'password'	=> '',
	'dbname'	=> 'koinkoin_alpha'
);

$db = Zend_Db::factory('PDO_MYSQL', $parametres);
$planDeCorrespondance = array('log_niveau' => 'priority', 'log_message' => 'message');
$redacteur = new Zend_Log_Writer_Db($db, 'v001_0002500_logs', $planDeCorrespondance);
$log_obj = new Zend_Log($redacteur);
$log_obj->log("Message d'information", Zend_Log::INFO);


















                   ï¿½ l'aide de filtres xpath, regex ou par ajout de scripts externes php,
                   pour -in fine- vous offrir la possibilitï¿½ de gï¿½rer intuitivement votre webscraping,
                   via des ecrans frontend et backend. */






	$log_obj->addPriority('VERBOSE', 8);


set_include_path(implode(PATH_SEPARATOR, array
(
	realpath ( APPLICATION_PATH . '/../library/Koinkoin/Session' ),
	get_include_path () ) ) 
);











ini_set ( 'display_errors', 'on' );
error_reporting ( E_ALL );










require_once 'Zend/Application.php';

// Create application, bootstrap, and run
$application = new Zend_Application ( APPLICATION_ENV, APPLICATION_PATH . '/configs/application.ini' );

// $host = 'localhost';
// $username = 'root';
// $password = '';
// $database = 'koinkoin_alpha';
// $link = mysqli_connect ( $host, $username, $password, $database ) or die ( 'Connexion a la base de donnees impossible!' );
// require 'Zebra_Session.php';
// $session = new Zebra_Session ( $link, 'ct($host, $username, $password, $database) or die(Connexion' );
// throw new Exception("<h1>VARIABLES DE SESSION (ZEBRA)</h1>");

const PROJET_NOM = 'koinkoin';
const PROJET_VERSION = "0.0.01";
const PROJET_LANGUE_UTILISEE = 'fr';
const API_NAME_CURL = 'zebra';
const API_NAME_REGEX = '';
const API_NAME_SESSION = 'zebra';
const API_NAME_XPATH = '';






require_once '../library/V/'.PROJET_VERSION.'/my_fonctions.php';
$my_fonctions = new my_fonctions();
$my_fonctions->library_v_inclure_tous_les_fichiers_php();
$my_fonctions->library_v_init_obj();













	
	/**
	* Rï¿½cupere le rï¿½sultat d'1 filtre xpath sur 1 page SSL
	* @link http://
	* @param string $url_ssl <p>
	* Url de la page SSL (https://) ï¿½ rï¿½cupï¿½rer.
	* </p>
	* @param int $filtre_xpath <p>
	* String contenant le filtre xpath
	* </p>
	* @return array Rï¿½sultats 
	* Ou FALSE si erreur
	*/	
function get_un_filtre_xpath_sur_un_url ($url,$filtre)
{
	$html = getSslPage($url);
	// Initialisation de DOM
	$dom = new DOMDocument();
	$dom->loadHTML($html);
	$dom_xpath = new DOMXPath($dom);
	// Execution de la requete XPATH
	$resultat_xpath = $dom_xpath->query($filtre);
	// Recuperation du resultat de la requete XPATH
	
	foreach ($resultat_xpath as $result_object)
	{
	    $resultat = $result_object->childNodes->item(0)->nodeValue;
	}
// 	$_SESSION['temp'] = $resultat;
// 	echo $_SESSION['temp'];
//  	echo $resultat;
// 	var_dump($resultat);
	
	return $resultat;
}
	
	
	
		
	
	public function inclure_library_mesfonctions_only()
	{
		try
		{				
			if ($this->inclure_toutes_mesfonctions())
			{
		throw new Exception("COQUILLE VIDE !");
			}
		}
		catch (Exception $exception_catch)
		{
			
		}
	}
	
	
	
	
	
	
	
	
	
	
	
	try
		{				
			if ($this->inclure_toutes_mesfonctions())
			{
		throw new Exception("COQUILLE VIDE !");
			}
		}
		catch (Exception $exception_catch)
		{
			
		}
		
		
		
		
		
		
		
		
		
		
	public function init()
    {
    	// TODO: a mettre en BDD
    	$_SESSION['kk']['projet']['nom'] = 'koinkoin';
    	$_SESSION['kk']['debug']['verbose'] = 0;
    	$_SESSION['kk']['debug']['num'] = 0; // o = rien, ou choisir niveaux 1, 2 ou 3
    	$_SESSION['kk']['version']['nom_dossier'] = 'V';
    	$_SESSION['kk']['version']['num_a_utiliser'] = '0.0.01';
    	$_SESSION['kk']['version']['num_reel'] = '0.0.01';
    	$_SESSION['kk']['mes_fonctions']['prefixe_nom_fichier'] = 'MesFonctions';
    	$_SESSION['kk']['multilangues']['actif'] = 0;
    	$_SESSION['kk']['multilangues']['langue_par_defaut'] = 'fr';
    	$_SESSION['kk']['multilangues']['langue_a_utiliser'] = 'espagnol';
    	$_SESSION['kk']['multilangues']['drapeau_fr'] = '../drapeau_fr_icone.gif';
    	
    	$_SESSION['kk']['txts']['fr']['programme']['arret_du_programme']['version_specifiee']['invalide'] = 'ARRET DU PROGRAMME : la version specifiee de koinkoin n\'existe pas';
    	$_SESSION['kk']['txts']['espagnol']['programme']['arret_du_programme']['version_specifiee']['invalide'] = 'PROGRAMMA ES STOPA : el versionne de koinkoin no appariente de nostre';
    	 
    	ini_set('display_errors','on');
    	error_reporting(E_ALL);
// 		require $_SESSION['kk']['version']['nom_dossier'].'/'.$_SESSION['kk']['version']['num_a_utiliser'].'/'."Curl/".$_SESSION['kk']['mes_fonctions']['prefixe_nom_fichier'].'_'.'Curl.php';
// 		require $_SESSION['kk']['version']['nom_dossier'].'/'.$_SESSION['kk']['version']['num_a_utiliser'].'/'."Xpath/".$_SESSION['kk']['mes_fonctions']['prefixe_nom_fichier'].'_'.'Xpath.php';
// 		require $_SESSION['kk']['version']['nom_dossier'].'/'.$_SESSION['kk']['version']['num_a_utiliser'].'/'."Regex/".$_SESSION['kk']['mes_fonctions']['prefixe_nom_fichier'].'_'.'Regex.php';
    	//require '../library/Simple_html_dom/Simple_html_dom.php';
    	if (isset($_GET['methode']))
    	{
    		if ($_GET['methode'] == 'uneUrlunFiltre')
    		{
    			if (isset($_GET['url']))
    			{
					if (!is_array($_GET['url']))
					{
	    				if(filter_var($_GET['url'], FILTER_VALIDATE_URL) === FALSE)
	    				{
	    					echo "ARRET DU SCRIPT : le parametre url n'est pas un url valide w3c";
	    					exit;
	    				}
	    				else
	    				{
	    					if (isset($_GET['filtre']))
	    					{
	    						$_SESSION['resultat'] = filtre_xpath_url($_GET['url'],$_GET['filtre']);
	    					}
	    					else 
	    					{
	    						echo "ARRET DU SCRIPT : aucun filtre donne en parametre d'url";
	    						var_dump($_SESSION);
	    						exit;
	    					}
	    				}
					}
					else 
					{
						echo "ARRET DU SCRIPT : un array url est passe en parametres, alors qu\'un url unique est attendu";
						var_dump($_SESSION);
						exit;
					}
    			}
    			else
    			{
    				echo "ARRET DU SCRIPT : parametre url non appelï¿½ / non invoquï¿½ / mal ou incorrectement renseignï¿½";
    				exit;
    			}
    		}
    		elseif ($_GET['methode'] == 'xUrlsunFiltre')
    		{
    		
    			if (isset($_GET['url']))
    			{
    				if (is_array($_GET['url']))
    				{
    					echo "ok";
    					throw new Exception(var_dump($_GET));
    				}
    				else 
    				{
    					echo "Warning : 1 seule url detectee dans le parametre url (changer la methode xUrlsunFiltre par uneUrlunFiltre) -> titre de l'annonce -> ";
    					echo $_SESSION['resultat'] = filtre_xpath_url($_GET['url'],$_GET['filtre']);
    					exit;
    				}
    			}
    			else
    			{
    				echo "ARRET DU SCRIPT : parametre urls non appelï¿½ / non invoquï¿½ / mal ou incorrectement renseignï¿½e/orthographiï¿½e";
    				exit;
    			}
    		}
    		else
    		{
    			echo "ARRET DU SCRIPT : methode invoquï¿½e dans l'url invalide -> essayer la methode 'xUrlsunFiltre'";
    			print_r($_SESSION);
    			exit;
    		}
    	}
    	else
    	{
    		echo 'ARRET DU SCRIPT : il faut renseigner un url koinkoin valide (url particulier pour koinkoin (methode,url,filtre))!';
    		exit;
    	}
   	}

    public function indexAction()
    {
    }
	
	
	
	
	
	
	
	
	
	
	
	// 		throw new Exception("<h1>ARRET DU PROGRAMME kk</h1><p>Coquille vide !</p><p>init_mesfonctions</p>");
	
	
	
	
	
	
	
	
		
// 		throw new Exception($version);
		try
		{
			switch ($this->version)
			{
				case '0.0.03':
					throw new Exception("<h1>ARRET DU PROGRAMME kk</h1><p>La version de kk demandee est invalide (v0.0.03?)</p>");
				case '0.0.02':
					throw new Exception("<h1>ARRET DU PROGRAMME kk</h1><p>La version de kk demandee est invalide (v0.0.02?)</p>");
				case '0.0.01':
					throw new Exception("<h1>ARRET DU PROGRAMME kk</h1><p>Version 0.0.01</p>");
					require_once 'Curl/MesFonctions_Curl.php';
					require_once 'Xpath/MesFonctions_Xpath.php';
					require_once 'Regex/MesFonctions_Regex.php';						
					return true;
					break;
				default:
					throw new Exception('ici');
			}
		}
		catch(Exception $exception_catch)
		{
			throw new Exception("<h1>ARRET DU PROGRAMME kk</h1><p>La version de kk demandee est invalide (dans le catch)</p>");
			return false;
		}
	















		throw new Exception('Coquille vide !');




	 					throw new Exception($_SESSION['kk']['txts']['fr']['programme']['arret_du_programme']['version_specifiee']['existe_pas']);
	 
	 	function init_mesfonctions()
	{
		if ($this->init_environnement_mesfonctions($_SESSION['kk']['version']['num_a_utiliser']) == false)
		{
			throw new Exception($_SESSION['kk']['txts']['fr']['programme']['arret_du_programme']['version_specifiee']['invalide']);
		}
	}
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	   	$this->renderScript('show-list.phtml')
	
	
	marche pas a cause dun parametrage foirix
	//    	echo '				<li><a href="'.$this->_helper->viewRenderer->setScriptAction('ajouter2').'">Release 0.01</a></li>'."\n";
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	$_SESSION['kk']['multilangues']['actif'] = 0;
	$_SESSION['kk']['multilangues']['langue_par_defaut'] = 'fr';
	$_SESSION['kk']['multilangues']['langue_a_utiliser'] = 'espagnol';
	$_SESSION['kk']['multilangues']['drapeau_fr'] = '../drapeau_fr_icone.gif';
	
	$_SESSION['kk']['txts']['fr']['programme']['arret_du_programme']['version_specifiee']['invalide'] = 'ARRET DU PROGRAMME : la version specifiee de koinkoin n\'existe pas';
	$_SESSION['kk']['txts']['espagnol']['programme']['arret_du_programme']['version_specifiee']['invalide'] = 'PROGRAMMA ES STOPA : el versionne de koinkoin no appariente de nostre';
	



variables d'environnement 




filtres_prefixes, base_filtres, after_filtres 


	echo '<!doctype html>'."\n";
	echo '<html>'."\n";
	echo '	<head>'."\n";
	echo '		<title>'.$_SESSION['projet']['nom'].' - '.$_SESSION['projet']['version'].'</title>'."\n";
	echo '	</head>'."\n";
	echo '	<body>'."\n";
	echo '		<div id="zone_haut">'."\n";
	echo '			<h1>KOINKOIN V001</h1>'."\n";
	echo '			<h2>MAQUETTE</h2>'."\n";
	echo '		</div><!-- fin zone_haut -->'."\n";
	echo '		<div id=zone_milieu>'."\n";
	echo '			<h3>FILTRES</h3>'."\n";
	echo '			<h4>Passage des parametres via l\'url</h4>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1&url[]=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> trop long</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=page&filtre=id%28%27listingAds%27%29/x:section/x:section/x:ul/x:li[2]&url=https://www.leboncoin.fr/offres_d_emploi/offres/">methode -> methode invoquï¿½ee invalide</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array attendu, seulement 1 url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '				<li><a href="http://127.0.0.1/KOINKOIN/public/filtre?methode=xUrlsunFiltre&filtre=.//*[@id=%27listingAds%27]/section/section/ul/li[2]/a/section/h2&url=https://www.leboncoin.fr/offres_d_emploi/offres/ile_de_france/?th=1">array url -> array url passe en parametres</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '			<h3>IHMS</h3>'."\n";
	echo '			<ul>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires formoid/v001/users___creer_un_utilisateur.html">user -> creer un utilisateur</a></li>'."\n";
	echo '				<li><a href="F:/[Tags]/Koinkoin/Formulaires%20formoid/v001/outils___importer_une_page_internet.html">outils -> importer une page web</a></li>'."\n";
	echo '			</ul>'."\n";
	echo '		</div><!-- fin zone_milieu -->'."\n";
	echo '	</body>'."\n";
	echo '</html>'."\n";
?>























//     	ini_set('display_errors','on');
//     	error_reporting(E_ALL);



    	try 
    	{
    		if (isset($_GET['methode']))
    		{
    			
    		}
    	}
    	catch (Zend_Exception $a) 
    	{
    		
    	}
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	if (isset($_GET['methode']))
    	{
    		if ($_GET['methode'] == 'uneUrlunFiltre')
    		{
    			if (isset($_GET['url']))
    			{
    				if (!is_array($_GET['url']))
    				{
    					if(filter_var($_GET['url'], FILTER_VALIDATE_URL) === FALSE)
    					{
    						echo "ARRET DU SCRIPT : le parametre url n'est pas un url valide w3c";
    						exit;
    					}
    					else
    					{
    						if (isset($_GET['filtre']))
    						{
    							$_SESSION['resultat'] = filtre_xpath_url($_GET['url'],$_GET['filtre']);
    						}
    						else
    						{
    							echo "ARRET DU SCRIPT : aucun filtre donne en parametre d'url";
    							var_dump($_SESSION);
    							exit;
    						}
    					}
    				}
    				else
    				{
    					echo "ARRET DU SCRIPT : un array url est passe en parametres, alors qu\'un url unique est attendu";
    					var_dump($_SESSION);
    					exit;
    				}
    			}
    			else
    			{
    				echo "ARRET DU SCRIPT : parametre url non appelï¿½ / non invoquï¿½ / mal ou incorrectement renseignï¿½";
    				exit;
    			}
    		}
    		elseif ($_GET['methode'] == 'xUrlsunFiltre')
    		{
    	
    			if (isset($_GET['url']))
    			{
    				if (is_array($_GET['url']))
    				{
    					echo "ok";
    					throw new Exception(var_dump($_GET));
    				}
    				else
    				{
    					echo "Warning : 1 seule url detectee dans le parametre url (changer la methode xUrlsunFiltre par uneUrlunFiltre) -> titre de l'annonce -> ";
    					echo $_SESSION['resultat'] = filtre_xpath_url($_GET['url'],$_GET['filtre']);
    					exit;
    				}
    			}
    			else
    			{
    				echo "ARRET DU SCRIPT : methode url ok mais parametre urls non appelï¿½ / non invoquï¿½ / mal ou incorrectement renseignï¿½e/orthographiï¿½e";
    				exit;
    			}
    		}
    		else
    		{
    			echo "ARRET DU SCRIPT : methode invoquï¿½e dans l'url invalide -> essayer la methode 'xUrlsunFiltre'";
    			print_r($_SESSION);
    			exit;
    		}
    	}
    	else
    	{
    		echo 'ARRET DU SCRIPT : il faut renseigner un url koinkoin valide (url particulier pour koinkoin (methode,url,filtre))!';
    		exit;
    	}
    	 
    
    }
    	   

















    	if (count($_GET) > 0)
    	{
			if (isset($_GET['methode']))
			{
				// public/index.php?methode=maquette
				if ($_GET['methode'] == 'maquette')
				{
					$this->_redirect('maquette');
				}
				else 
				{
					throw new Exception("ARRET DU SCRIPT : methode invoquee dans l'url invalide -> essayer la methode 'maquette' par exemple");
				}
			}
			else 
			{
				throw new Exception('le mot utilise dans le parametre de l\'url n\est pas le mot "methode"');
			}
    	}
    	else 
    	{
			// url koinkoin invalide et vierge de tout parametres dans l\'url(aucune methode invoquee dans parametre url)
			// -> par defaut = maquette
    		$this->_redirect('maquette');
    	}
    
dans le controleur
$this->render('releases');

dans la vue
$this->_redirect('controleur/vue');






autoloadernamespaces[] = "NR_Application_"






dans une vue tu peux appeler un controller par
Code : 	Sï¿½lectionner tout - Visualiser dans une fenï¿½tre ï¿½ part

$this->action('action','controller','module');

, sinon tu ï¿½ la mï¿½thode depuis ton controlleur
Code : 	Sï¿½lectionner tout - Visualiser dans une fenï¿½tre ï¿½ part

$this->_redirect('module/controller/action');

ou encore
Code : 	Sï¿½lectionner tout - Visualiser dans une fenï¿½tre ï¿½ part

$this->_forward($action,$controller,$modules,array $params)

. A toi de choisir la mï¿½thode qui te convient. 

    	
    	
    	
    	
    	
    	
    	
    	
    	$this->_redirect('module/controller/action');




//     					if is_url($_GET($urls)) if(filter_var($_GET['urls'], FILTER_VALIDATE_URL) === FALSE)
    						// if is_unique($_GET($filtres)
    							// foreach($_GET['urls'] as $url
//     								$_SESSION['xUrlsunFiltre']['resultats'] = filtre_xpath_url($_GET['url'],$_GET['filtre']);









// 	ini_set('display_errors','off');
// 	error_reporting(E_ALL);








	
	$html = file_get_contents($url);







	/**
	* Rï¿½cupere le rï¿½sultat d'1 filtre xpath sur 1 page SSL
	* @link http://
	* @param string $url_ssl <p>
	* Url de la page SSL (https://) ï¿½ rï¿½cupï¿½rer.
	* </p>
	* @param int $filtre_xpath <p>
	* String contenant le filtre xpath
	* </p>
	* @return array $xpath 
	* Ou FALSE si erreur
	*/




	exit;
	
	
	ini_set('display_errors','off');
	error_reporting(E_ALL);
	
	$w = stream_get_wrappers();
	echo 'openssl: ',  extension_loaded  ('openssl') ? 'yes':'no', "\n";
	echo 'http wrapper: ', in_array('http', $w) ? 'yes':'no', "\n";
	echo 'https wrapper: ', in_array('https', $w) ? 'yes':'no', "\n";
	echo 'wrappers: ', var_dump($w);
	
	
	$course_date___date_utc_officielle___xpath = ".//*[@id='listingAds']/section/section/ul/li[1]/a/section/h2"; // SCRAPE LA DATE OFFICIELLE UTC DE LA COURSE SUR LA PAGE (DANS LE TABLEAU)
	$url = "https://www.leboncoin.fr/annonces/offres/ile_de_france/";
	echo 'html -> ';




if (!function_exists('curl_download'))
	{
		die('ARRET DU SCRIPT : curl_fonctions non accessible');
		exit;
	}






echo $html;
	// Initialisation de DOM pour XPATH
	
	$html = str_get_html($html);
	
	
	$dom_xpath = new DOMXPath($html);
	// Execution de la requete XPATH
	$resultat_xpath = $dom_xpath->query($filtre);
	// Recuperation du resultat de la requete XPATH
	foreach ($resultat_xpath as $result_object){
		$val = $result_object->childNodes->item(0)->nodeValue;
	}
	return $val;


	$html = curl_download($url);






echo "coucou";
    					$html = curl_download($_GET['url']);
    					echo $html;


//     	$this->filtre_xpath_page("id('listingAds')/x:section/x:section/x:ul/x:li[2]","https://www.leboncoin.fr/offres_d_emploi/offres/");


echo 'Bonjour ' . $_GET['methode'];


127.0.0.1/KOINKOIN/public/filtre?method=page&filtre=id('listingAds')/x:section/x:section/x:ul/x:li[2]&url=https://www.leboncoin.fr/offres_d_emploi/offres/





          	require '../library/Simple_html_dom/Simple_html_dom.php';
          	
          	
          	
//         $html = file_get_html('https://www.leboncoin.fr/informatique/928473012.htm?ca=12_s');
//         $strhtml = $html;
//         $tmp= $html->find('a, img');
            
// 		$a = strlen($html);//var_dump($html);
// 		echo $a;
// 		$b = strlen($tmp);
		//var_dump($tmp);
		
		
// 		foreach($html->find('img') as $element)
// 			echo $element->src . '<br>';
		
			
// 			echo $html;
		

// If you are not so familiar with HTML DOM, check this link to learn more...

// Example
//echo $html->find("#div1", 0)->children(1)->children(1)->children(2)->id;
// or
// echo $html->getElementById("div")->childNodes(1)->childNodes(1)->childNodes(2)->getAttribute('id');
// $html->getElementById("a");

// foreach($html as $item) { // DOMElement Object
// 	$href =  $item->getAttribute("href");
// 	$text = trim(preg_replace("/[\r\n]+/", " ", $item->nodeValue));
// // 	$links[] = array(
// 			'href' => $href,
// 			'text' => $text
// 	);
// }
			
// 			foreach($html->find('h1') as $element)
// 				echo $element->src . '<br>';
			
					
// 				echo $html;
			
			
            //echo $html;
            // Find all anchors and images
            // Find all anchors and images
			//var_dump($tmp);
			//var_export($ret);
            //var_dump($ret);
        ?>
    </div>
</div>
